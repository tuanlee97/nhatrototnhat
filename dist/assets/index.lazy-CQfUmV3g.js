import{j as e,X as ce,ad as De,B as C,Z as he,ae as _e,af as U,ag as ke,W as ee,I,r as v,ah as Ie,ai as Fe,aj as z,ak as we,al as Me,am as ae,Y as Ve,_ as O,ao as E,f as K,ap as Be,z as x,a1 as se,ar as Le,e as oe,t as de,a2 as ne,n as b,a3 as $,a4 as G,a5 as W,a6 as J,a7 as Y,F as me,C as xe,at as ue,g as F,h as w,i as M,k as V,aJ as Pe,aK as He,aL as Ae,aM as Ke,aN as qe,aP as ze,aQ as Oe,aO as Ee,aR as Xe,l as B,aa as Z,o as k,aB as Qe,aC as Ue,aT as $e,aU as Ge,S as We,s as Je,v as Ye,w as Ze,x as X,K as Re,aE as es,p as ss,H as ns,E as as,T as ts,J as is,M as ls,c as rs}from"./index-CJ1AcNxb.js";import{M as cs,C as hs,a as os,f as te,b as ds,g as ms,c as xs,d as us,e as gs,h as ps,i as js,u as vs,D as fs,I as bs,k as Cs,j as ys,l as Ns,m as Ss,T as Ts}from"./index-BcGaQFY_.js";import{d as Ds,C as ie,L as le}from"./debounce-CMqhm6O_.js";import{D as Q}from"./data-table-column-header-FtAG0BCC.js";import{I as R}from"./IconEdit-DyWwXMJq.js";import{r as _s}from"./schema-DFUXsWFl.js";import{a as ks}from"./schema-C2tS-PoL.js";import{C as ge,A as pe,a as je,b as ve}from"./alert-bq5yZ8aI.js";import{I as fe}from"./IconAlertTriangle-VRRGoB_F.js";import{I as Is}from"./IconUserPlus-DlXZMKer.js";const Fs={name:"Tên chi nhánh",address:"Địa chỉ",phone:"Số điện thoại"};function ws({table:s}){return e.jsxs(ce,{modal:!1,children:[e.jsx(De,{asChild:!0,children:e.jsxs(C,{variant:"outline",size:"sm",className:"ml-auto hidden h-8 lg:flex",children:[e.jsx(cs,{className:"mr-2 h-4 w-4"}),"Xem"]})}),e.jsxs(he,{align:"end",className:"w-[150px]",children:[e.jsx(_e,{children:"Hiển thị cột"}),e.jsx(U,{}),s.getAllColumns().filter(n=>typeof n.accessorFn<"u"&&n.getCanHide()).map(n=>e.jsx(ke,{className:"capitalize",checked:n.getIsVisible(),onCheckedChange:i=>n.toggleVisibility(!!i),children:Fs[n.id]},n.id))]})]})}function Ms({table:s,setSearch:n}){var m,h;const i=s.getState().columnFilters.length>0||!!((m=s.getColumn("name"))!=null&&m.getFilterValue()),d=ee.useMemo(()=>Ds(t=>n(t),500),[n]),p=t=>{var o;(o=s.getColumn("name"))==null||o.setFilterValue(t),d(t)};return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx(I,{placeholder:"Lọc theo tên...",value:((h=s.getColumn("name"))==null?void 0:h.getFilterValue())??"",onChange:t=>p(t.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),i&&e.jsxs(C,{variant:"ghost",onClick:()=>{n(""),s.resetColumnFilters()},className:"h-8 px-2 lg:px-3",children:["Xóa lọc",e.jsx(hs,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(ws,{table:s})]})}function Vs({columns:s,data:n,pagination:i,setPage:d,setLimit:p,setSearch:m}){var N;const[h,t]=v.useState({}),[o,j]=v.useState({}),[u,T]=v.useState([]),[D,L]=v.useState([]),y=os({data:n,columns:s,state:{sorting:D,columnVisibility:o,rowSelection:h,columnFilters:u,pagination:{pageIndex:i.current_page-1,pageSize:i.limit}},manualPagination:!0,pageCount:i.total_pages,enableRowSelection:!0,onRowSelectionChange:t,onSortingChange:L,onColumnFiltersChange:T,onColumnVisibilityChange:j,getCoreRowModel:js(),getFilteredRowModel:ps(),getPaginationRowModel:gs(),getSortedRowModel:us(),getFacetedRowModel:xs(),getFacetedUniqueValues:ms()});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ms,{table:y,setSearch:m}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(Ie,{children:[e.jsx(Fe,{children:y.getHeaderGroups().map(l=>e.jsx(z,{className:"group/row",children:l.headers.map(r=>{var c;return e.jsx(we,{colSpan:r.colSpan,className:((c=r.column.columnDef.meta)==null?void 0:c.className)??"",children:r.isPlaceholder?null:te(r.column.columnDef.header,r.getContext())},r.id)})},l.id))}),e.jsx(Me,{children:(N=y.getRowModel().rows)!=null&&N.length?y.getRowModel().rows.map(l=>e.jsx(z,{"data-state":l.getIsSelected()&&"selected",className:"group/row",children:l.getVisibleCells().map(r=>{var c;return e.jsx(ae,{className:((c=r.column.columnDef.meta)==null?void 0:c.className)??"",children:te(r.column.columnDef.cell,r.getContext())},r.id)})},l.id)):e.jsx(z,{children:e.jsx(ae,{colSpan:s.length,className:"h-24 text-center",children:"Không có kết quả."})})})]})}),e.jsx(ds,{table:y,setPage:d,setLimit:p,totalRecords:i.total_records})]})}const be=ee.createContext(null);function Bs({children:s}){const[n,i]=vs(null),[d,p]=v.useState(null),[m,h]=v.useState(null);return e.jsx(be,{value:{open:n,setOpen:i,currentRow:d,setCurrentRow:p,currentRowIndex:m,setCurrentRowIndex:h},children:s})}const q=()=>{const s=ee.useContext(be);if(!s)throw new Error("useBranches has to be used within <BranchesContext>");return s};function Ls({row:s}){const{setOpen:n,setCurrentRow:i}=q();return e.jsx(e.Fragment,{children:e.jsxs(ce,{modal:!1,children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(C,{variant:"ghost",className:"flex h-8 w-8 p-0 data-[state=open]:bg-muted",children:[e.jsx(fs,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsxs(he,{align:"end",className:"w-[160px]",children:[e.jsxs(O,{onClick:()=>{i(s.original),n("edit")},children:["Chỉnh sửa",e.jsx(E,{children:e.jsx(R,{size:16})})]}),e.jsx(U,{}),e.jsxs(O,{onClick:()=>{i(s.original),n("add-service")},children:["Thêm/ Sửa dịch vụ",e.jsx(E,{children:e.jsx(R,{size:16})})]}),e.jsx(U,{}),e.jsxs(O,{onClick:()=>{i(s.original),n("delete")},className:"!text-red-500",children:["Xóa",e.jsx(E,{children:e.jsx(bs,{size:16})})]})]})]})})}function Ps({row:s}){const{setOpen:n,setCurrentRow:i}=q();return e.jsxs(C,{variant:"outline",onClick:()=>{i(s.original),n("add-service")},children:["Dịch vụ",e.jsx(R,{size:16})]})}const Hs=[{id:"select",header:({table:s})=>e.jsx(ie,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:n=>s.toggleAllPageRowsSelected(!!n),"aria-label":"Select all",className:"translate-y-[2px]"}),meta:{className:K("sticky md:table-cell left-0 z-10 rounded-tl","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted")},cell:({row:s})=>e.jsx(ie,{checked:s.getIsSelected(),onCheckedChange:n=>s.toggleSelected(!!n),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:({column:s})=>e.jsx(Q,{column:s,title:"Tên chi nhánh"}),cell:({row:s})=>e.jsx(le,{className:"max-w-36",children:s.getValue("name")}),meta:{className:"w-36"}},{accessorKey:"address",header:({column:s})=>e.jsx(Q,{column:s,title:"Địa chỉ"}),cell:({row:s})=>e.jsx(le,{className:"",children:s.getValue("address")}),meta:{className:K("drop-shadow-[0_1px_2px_rgb(0_0_0_/_0.1)] dark:drop-shadow-[0_1px_2px_rgb(255_255_255_/_0.1)] lg:drop-shadow-none","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted","sticky left-6 md:table-cell")},enableSorting:!0},{accessorKey:"phone",header:({column:s})=>e.jsx(Q,{column:s,title:"Hotline"}),cell:({row:s})=>e.jsx("div",{children:Be(s.getValue("phone"))}),enableSorting:!1},{id:"utility_usage",cell:Ps},{id:"actions",cell:Ls}];x.object({id:x.number(),owner_id:x.string().min(1,"Vui lòng nhập ID chủ nhà trọ"),name:x.string().min(1,"Vui lòng nhập tên chi nhánh"),address:x.string().min(1,"Vui lòng nhập địa chỉ"),phone:x.string().min(1,"Vui lòng nhập số điện thoại").regex(/^0[0-9]{9}$/,"Số điện thoại không hợp lệ, phải bắt đầu bằng 0 và có 10 chữ số")});const Ce=x.object({id:x.number().optional(),owner_id:x.string().min(1,"Vui lòng nhập ID chủ nhà trọ"),name:x.string().min(1,"Vui lòng nhập tên chi nhánh"),address:x.string().min(1,"Vui lòng nhập địa chỉ"),phone:x.string().min(1,"Vui lòng nhập số điện thoại").regex(/^0[0-9]{9}$/,"Số điện thoại không hợp lệ, phải bắt đầu bằng 0 và có 10 chữ số")});x.array(Ce);x.object({customers:x.array(ks),rooms:x.array(_s)});function re({currentRow:s,open:n,onOpenChange:i,page:d,limit:p,search:m}){const h=!!(s!=null&&s.id),t=se(),{user:o}=Le.getState().auth,j=(o==null?void 0:o.role)==="admin",u=oe({resolver:de(Ce),defaultValues:h?{owner_id:String(s.owner_id),name:s.name,address:s.address,phone:s.phone}:{owner_id:String(o==null?void 0:o.id)??"",name:"",address:"",phone:""}}),{data:T,isLoading:D,error:L}=ne({queryKey:["owners"],queryFn:()=>k.getAllUsers({role:"owner"}),enabled:j,staleTime:5*60*1e3}),y=(T==null?void 0:T.data)||[];v.useEffect(()=>{n||u.reset()},[n,u]),v.useEffect(()=>{L&&b({title:"Lỗi tải danh sách chủ nhà trọ",description:L.message||"Vui lòng thử lại sau",variant:"destructive"})},[L]);const N=async l=>{var r,c;try{let S=l.phone;if(S&&!S.startsWith("0")&&(S="0"+S),l.phone=S,h){if(!(s!=null&&s.id))throw new Error("Branch ID is missing");if(!(await k.updateBranch({id:s.id,owner_id:l.owner_id,name:l.name,address:l.address,phone:l.phone})).data.id)throw new Error("API response missing branch ID")}else if(!(await k.createBranch({owner_id:l.owner_id,name:l.name,address:l.address,phone:l.phone})).data.id)throw new Error("API response missing branch ID");t.invalidateQueries({queryKey:["branches",d,p,m]}),b({title:h?"Cập nhật thành công!":"Tạo chi nhánh thành công!"}),i(!1)}catch(S){console.error("Submit error:",S);const H=((c=(r=S.response)==null?void 0:r.data)==null?void 0:c.message)||S.message||"Lỗi hệ thống, vui lòng thử lại sau";b({title:h?"Cập nhật thất bại":"Tạo chi nhánh thất bại",description:H,variant:"destructive"})}};return e.jsx($,{open:n,onOpenChange:i,children:e.jsxs(G,{className:"sm:max-w-lg",children:[e.jsxs(W,{className:"text-left",children:[e.jsx(J,{children:h?"Chỉnh sửa chi nhánh":"Thêm chi nhánh mới"}),e.jsxs(Y,{children:[h?"Chỉnh sửa chi nhánh tại đây.":"Tạo chi nhánh mới tại đây."," ","Nhấp vào Xác nhận khi bạn hoàn tất."]})]}),e.jsx(me,{...u,children:e.jsxs("form",{onSubmit:u.handleSubmit(N),className:"space-y-4",children:[e.jsx(xe,{children:e.jsxs(ue,{className:"space-y-2 pt-6",children:[e.jsx(F,{control:u.control,name:"owner_id",render:({field:l})=>{var r;return e.jsxs(w,{className:"grid grid-cols-6 items-center gap-x-4 gap-y-1 space-y-0",children:[e.jsx(M,{className:"col-span-2 text-left",children:"Chủ nhà trọ"}),e.jsx(V,{children:j?D?e.jsx("p",{className:"col-span-4 text-sm",children:"Đang tải danh sách chủ nhà trọ..."}):e.jsxs(Pe,{children:[e.jsx(He,{asChild:!0,children:e.jsxs(C,{variant:"outline",role:"combobox",className:K("col-span-4 justify-between",!l.value&&"text-muted-foreground"),disabled:h,children:[l.value?(r=y.find(c=>c.id===l.value))==null?void 0:r.username:"Chọn chủ nhà trọ",e.jsx(Cs,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(Ae,{className:"w-full p-0",children:e.jsxs(Ke,{children:[e.jsx(qe,{placeholder:"Tìm chủ nhà trọ..."}),e.jsx(ze,{children:"Không tìm thấy chủ nhà trọ."}),e.jsx(Oe,{children:e.jsx(Ee,{children:y.map(c=>e.jsxs(Xe,{value:c.username,onSelect:()=>{u.setValue("owner_id",c.id)},children:[e.jsx(ys,{className:K("mr-2 h-4 w-4",c.id===l.value?"opacity-100":"opacity-0")}),c.username]},c.id))})})]})})]}):e.jsx(I,{className:"col-span-4",value:(o==null?void 0:o.username)||"",disabled:!0})}),e.jsx(B,{className:"col-span-4 col-start-3"})]})}}),e.jsx(F,{control:u.control,name:"name",render:({field:l})=>e.jsxs(w,{className:"grid grid-cols-6 items-center gap-x-4 gap-y-1 space-y-0",children:[e.jsx(M,{className:"col-span-2 text-left",children:"Tên"}),e.jsx(V,{children:e.jsx(I,{placeholder:"Sunshine Bình Thạnh",className:"col-span-4",autoComplete:"off",...l})}),e.jsx(B,{className:"col-span-4 col-start-3"})]})}),e.jsx(F,{control:u.control,name:"address",render:({field:l})=>e.jsxs(w,{className:"grid grid-cols-6 items-center gap-x-4 gap-y-1 space-y-0",children:[e.jsx(M,{className:"col-span-2 text-left",children:"Địa chỉ"}),e.jsx(V,{children:e.jsx(I,{placeholder:"6 Hoàng Hoa Thám, Phường 7, Bình Thạnh, Hồ Chí Minh",className:"col-span-4",...l})}),e.jsx(B,{className:"col-span-4 col-start-3"})]})}),e.jsx(F,{control:u.control,name:"phone",render:({field:l})=>e.jsxs(w,{className:"grid grid-cols-6 items-center gap-x-4 gap-y-1 space-y-0",children:[e.jsx(M,{className:"col-span-2 text-left",children:"Số điện thoại"}),e.jsx(V,{children:e.jsx(I,{placeholder:"0901234567",className:"col-span-4",...l,onChange:r=>{let c=r.target.value.replace(/[^0-9]/g,"");c&&!c.startsWith("0")&&(c="0"+c),l.onChange(c)}})}),e.jsx(B,{className:"col-span-4 col-start-3"})]})})]})}),e.jsx(Z,{children:e.jsx(C,{type:"submit",children:"Xác nhận"})})]})})]})})}function As({open:s,onOpenChange:n,currentRow:i,page:d,limit:p,search:m}){const h=se();async function t(){var o,j;try{i!=null&&i.id||await k.deleteBranch(i.id),h.invalidateQueries({queryKey:["branches",d,p,m]}),b({title:"Xóa chi nhánh thành công!"})}catch(u){b({title:"Xóa chi nhánh thất bại",description:((j=(o=u.response)==null?void 0:o.data)==null?void 0:j.message)||"Lỗi hệ thống, vui lòng thử lại sau",variant:"destructive"})}finally{n(!1)}}return e.jsx(ge,{open:s,onOpenChange:n,handleConfirm:t,title:e.jsxs("span",{className:"text-destructive",children:[e.jsx(fe,{className:"mr-1 inline-block stroke-destructive",size:18})," ","Xóa chi nhánh"]}),desc:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"mb-2",children:["Bạn chắc chắn muốn xóa chi nhánh"," ",e.jsx("span",{className:"font-bold",children:i.name}),"?"]}),e.jsxs(pe,{variant:"destructive",children:[e.jsx(je,{children:"Cảnh báo!"}),e.jsx(ve,{children:"Cẩn trọng, hành động này không thể hoàn tác."})]})]}),confirmText:"Xóa",destructive:!0})}const Ks=x.enum(["electricity","water","other"]),qs=x.object({id:x.number().optional(),name:x.string().min(1,"Tên dịch vụ không được để trống"),price:x.number().min(0,"Giá phải lớn hơn hoặc bằng 0"),unit:x.string().min(1,"Đơn vị không được để trống"),branch_id:x.number().min(1,"Chi nhánh không được để trống"),type:Ks.default("other")});function zs({currentRow:s,open:n,onOpenChange:i,page:d,limit:p,search:m}){const h=se(),[t,o]=v.useState([]),[j,u]=v.useState(null),[T,D]=v.useState(!1),[L,y]=v.useState(!1),[N,l]=v.useState(null),r=oe({resolver:de(qs),defaultValues:{name:"",price:0,unit:"",branch_id:s!=null&&s.id?Number(s.id):0,type:"other"}}),{data:c,isLoading:S}=ne({queryKey:["services",s==null?void 0:s.id],queryFn:()=>k.getAllServices({branchId:s==null?void 0:s.id}),enabled:!!(s!=null&&s.id),staleTime:5*60*1e3});v.useEffect(()=>{n&&(s!=null&&s.id)&&(c!=null&&c.data)?o(c.data.map(a=>({...a,isTemp:!1}))):n||(o([]),r.reset(),u(null),D(!1))},[n,s,c,r]);const H=async a=>{var g;try{const f=[...t];if(f.find(P=>P.name.toLowerCase()===a.name.toLowerCase()&&f.indexOf(P)!==j&&P.branch_id===(s!=null&&s.id?Number(s.id):0))){b({title:"Dịch vụ đã tồn tại",description:"Tên dịch vụ đã tồn tại trong chi nhánh này.",variant:"destructive"});return}const A={...a,price:Number(a.price),branch_id:Number(a.branch_id)};j!==null?(f[j]={...A,id:(g=f[j])==null?void 0:g.id},b({title:"Cập nhật dịch vụ thành công!"})):(f.push(A),b({title:"Thêm dịch vụ mới thành công!"})),o(f),r.reset({name:"",price:0,unit:"",branch_id:s!=null&&s.id?Number(s.id):0,type:"other"}),u(null),D(!1)}catch(f){console.error("Service submit error:",f);const _=f.message||"Lỗi hệ thống, vui lòng thử lại sau";b({title:j!==null?"Cập nhật dịch vụ thất bại":"Thêm dịch vụ thất bại",description:_,variant:"destructive"})}},ye=async()=>{var a,g,f;if(N===null||!((a=t[N])!=null&&a.id)){const _=t.filter((A,P)=>P!==N);o(_),y(!1),l(null),b({title:"Xóa dịch vụ thành công!"});return}try{await k.deleteService({id:String(t[N].id)});const _=t.filter((A,P)=>P!==N);o(_),h.invalidateQueries({queryKey:["services",s==null?void 0:s.id]}),b({title:"Xóa dịch vụ thành công!"})}catch(_){console.error("Delete service error:",_),b({title:"Xóa dịch vụ thất bại",description:((f=(g=_.response)==null?void 0:g.data)==null?void 0:f.message)||"Lỗi hệ thống, vui lòng thử lại sau",variant:"destructive"})}finally{y(!1),l(null)}},Ne=a=>{r.reset({name:t[a].name,price:Number(t[a].price),unit:t[a].unit,branch_id:Number(t[a].branch_id),type:t[a].type||"other"}),u(a),D(!0)},Se=async()=>{try{for(const a of t){const g={id:a.id,name:a.name,price:Number(a.price),unit:a.unit,branch_id:Number(a.branch_id),type:a.type};a.id?await k.updateService(g):await k.createService({name:g.name,price:g.price,unit:g.unit,branch_id:g.branch_id,type:g.type})}h.invalidateQueries({queryKey:["services",s==null?void 0:s.id]}),h.invalidateQueries({queryKey:["branches",d,p,m]}),b({title:"Cập nhật dịch vụ thành công!"}),i(!1)}catch(a){console.error("Confirm submit error:",a);const g=a.message||"Lỗi hệ thống, vui lòng thử lại sau";b({title:"Cập nhật dịch vụ thất bại",description:g,variant:"destructive"})}},Te=a=>{switch(a){case"electricity":return"Điện";case"water":return"Nước";default:return"Khác"}};return e.jsx($,{open:n,onOpenChange:i,children:e.jsxs(G,{className:"sm:max-w-[600px]",children:[e.jsxs(W,{className:"text-left",children:[e.jsx(J,{children:"Quản lý dịch vụ chi nhánh"}),e.jsxs(Y,{children:["Quản lý các dịch vụ cho chi nhánh ",(s==null?void 0:s.name)||"N/A",'. Nhấn "Thêm dịch vụ" để thêm mới hoặc chỉnh sửa dịch vụ hiện có.']})]}),e.jsxs(xe,{className:"mt-4",children:[e.jsxs(Qe,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Ue,{children:"Danh sách dịch vụ"}),e.jsxs($e,{children:["Danh sách các dịch vụ đã thêm hoặc chỉnh sửa (",t.length," dịch vụ)"]})]}),e.jsxs($,{open:T,onOpenChange:D,children:[e.jsx(Ge,{asChild:!0,children:e.jsxs(C,{variant:"outline",className:"flex items-center gap-2",onClick:()=>u(null),children:[e.jsx(Ns,{className:"h-4 w-4"}),"Thêm dịch vụ"]})}),e.jsxs(G,{className:"sm:max-w-md",children:[e.jsxs(W,{children:[e.jsx(J,{children:j!==null?"Chỉnh sửa dịch vụ":"Thêm dịch vụ mới"}),e.jsx(Y,{children:"Nhập thông tin dịch vụ và nhấn OK để lưu tạm thời hoặc Hủy để thoát."})]}),e.jsx(me,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(H),className:"space-y-4",children:[e.jsx(F,{control:r.control,name:"name",render:({field:a})=>e.jsxs(w,{children:[e.jsx(M,{children:"Tên dịch vụ"}),e.jsx(V,{children:e.jsx(I,{placeholder:"Rác",...a})}),e.jsx(B,{})]})}),e.jsx(F,{control:r.control,name:"price",render:({field:a})=>e.jsxs(w,{children:[e.jsx(M,{children:"Giá"}),e.jsx(V,{children:e.jsx(I,{type:"number",placeholder:"60000",value:a.value||0,onChange:g=>a.onChange(g.target.value?parseFloat(g.target.value):0)})}),e.jsx(B,{})]})}),e.jsx(F,{control:r.control,name:"unit",render:({field:a})=>e.jsxs(w,{children:[e.jsx(M,{children:"Đơn vị"}),e.jsx(V,{children:e.jsx(I,{placeholder:"tháng",...a})}),e.jsx(B,{})]})}),e.jsx(F,{control:r.control,name:"type",render:({field:a})=>e.jsxs(w,{children:[e.jsx(M,{children:"Loại dịch vụ"}),e.jsxs(We,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(V,{children:e.jsx(Je,{children:e.jsx(Ye,{placeholder:"Chọn loại dịch vụ"})})}),e.jsxs(Ze,{children:[e.jsx(X,{value:"electricity",children:"Điện"}),e.jsx(X,{value:"water",children:"Nước"}),e.jsx(X,{value:"other",children:"Khác"})]})]}),e.jsx(B,{})]})}),e.jsxs(Z,{children:[e.jsx(C,{type:"button",variant:"outline",onClick:()=>{D(!1),r.reset(),u(null)},children:"Hủy"}),e.jsx(C,{type:"submit",children:"OK"})]})]})})]})]})]}),e.jsx(Re,{}),e.jsx(ue,{className:"space-y-3 pt-4",children:S?e.jsx("p",{className:"text-center text-muted-foreground",children:"Đang tải dữ liệu..."}):t.length?t.map((a,g)=>{var f;return e.jsxs("div",{className:"flex items-center justify-between rounded-md border p-3 hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:a.name}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Loại: ",Te(a.type),!a.id&&e.jsx("sup",{className:"ml-2 text-red-500 font-semibold",children:"Mới"})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium",children:[es(a.price)," / ",a.unit]}),e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>Ne(g),children:e.jsx(Ss,{className:"h-4 w-4"})}),e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>{l(g),y(!0)},children:e.jsx(Ts,{className:"h-4 w-4 text-red-500"})})]}),e.jsx(ge,{open:L,onOpenChange:y,handleConfirm:ye,title:e.jsxs("span",{className:"text-destructive",children:[e.jsx(fe,{className:"mr-1 inline-block stroke-destructive",size:18})," ","Xóa dịch vụ"]}),desc:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"mb-2",children:["Bạn chắc chắn muốn xóa dịch vụ"," ",e.jsx("span",{className:"font-bold",children:(f=t[N||0])==null?void 0:f.name}),"?"]}),e.jsxs(pe,{variant:"destructive",children:[e.jsx(je,{children:"Cảnh báo!"}),e.jsx(ve,{children:"Cẩn trọng, hành động này không thể hoàn tác."})]})]}),confirmText:"Xóa",destructive:!0})]},a.id||`temp-${g}`)}):e.jsx("p",{className:"text-center text-muted-foreground",children:'Chưa có dịch vụ nào. Nhấn "Thêm dịch vụ" để bắt đầu.'})})]}),e.jsxs(Z,{className:"mt-4",children:[e.jsx(C,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Hủy"}),e.jsx(C,{type:"button",onClick:Se,disabled:t.length===0,children:"Xác nhận"})]})]})})}function Os({page:s,limit:n,search:i}){const{open:d,setOpen:p,currentRow:m,setCurrentRow:h}=q();return d?e.jsxs(e.Fragment,{children:[d==="add"&&e.jsx(re,{open:!0,onOpenChange:()=>p(d),page:s,limit:n,search:i},"branch-add"),m&&e.jsxs(e.Fragment,{children:[d==="edit"&&e.jsx(re,{open:!0,onOpenChange:()=>{p(d),setTimeout(()=>{h(null)},500)},currentRow:m,page:s,limit:n,search:i},`branch-edit-${m.id}`),d==="add-service"&&e.jsx(zs,{open:!0,onOpenChange:()=>{p(null),setTimeout(()=>{h(null)},500)},currentRow:m,page:s,limit:n,search:i},`branch-add-service-${m.id}`),d==="delete"&&e.jsx(As,{open:!0,onOpenChange:()=>{p(d),setTimeout(()=>{h(null)},500)},currentRow:m,page:s,limit:n,search:i},`branch-delete-${m.id}`)]})]}):null}function Es(){const{setOpen:s}=q();return e.jsx("div",{className:"flex gap-2",children:e.jsxs(C,{className:"space-x-1",onClick:()=>s("add"),children:[e.jsx("span",{children:"Thêm chi nhánh"})," ",e.jsx(Is,{size:18})]})})}function Xs(){const{toast:s}=ss(),[n,i]=v.useState(1),[d,p]=v.useState(10),[m,h]=v.useState(""),{data:t,isLoading:o,error:j}=ne({queryKey:["branches",n,d,m],queryFn:()=>k.getAllBranches({page:n,limit:d,search:m}),staleTime:5*60*1e3,retry:2});j&&s({variant:"destructive",title:"Lỗi khi tải danh sách chi nhánh",description:j.message,duration:5e3});const u=(t==null?void 0:t.data)||[],T=(t==null?void 0:t.pagination)||{current_page:1,limit:10,total_records:0,total_pages:1};return e.jsxs(Bs,{children:[e.jsxs(ns,{fixed:!0,children:[e.jsx(as,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(ts,{}),e.jsx(is,{})]})]}),e.jsx(ls,{children:o&&!t?e.jsx("div",{className:"flex h-full items-center justify-center",children:"Đang tải chi nhánh..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center justify-between space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Danh sách chi nhánh"}),e.jsx("p",{className:"text-muted-foreground",children:"Quản lý chi nhánh."})]}),e.jsx(Es,{})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Vs,{data:u,columns:Hs,pagination:T,setPage:i,setLimit:p,setSearch:h})})]})}),e.jsx(Os,{page:n,limit:d,search:m})]})}const sn=rs("/_authenticated/branches/")({component:Xs});export{sn as Route};
