import{z as e,j as n,a3 as _,a4 as y,a5 as v,a6 as N,a7 as S,y as C,F as T,g as o,h,i as m,S as F,k as d,s as w,v as A,w as I,x as X,l as u,I as x,aa as D,B as j,ar as q,n as p,o as H}from"./index-j9nM6RGn.js";import{I as K}from"./IconPlus-C2M1mHCj.js";import{C as P,A as B,a as E,b as M}from"./alert-gbH3okgA.js";import{I as z}from"./IconAlertTriangle-D5iXQf0H.js";const J=e.object({id:e.number().optional(),branch_id:e.number().optional(),room_id:e.number().min(1,{message:"Phòng là bắt buộc."}),user_id:e.number().min(1,{message:"Khách hàng là bắt buộc."}),start_date:e.string().min(1,{message:"Ngày bắt đầu là bắt buộc."}),end_date:e.string().min(1,{message:"Ngày kết thúc là bắt buộc."}),deposit:e.number().min(0,{message:"Tiền cọc phải lớn hơn hoặc bằng 0."}).optional(),status:e.string().optional(),created_at:e.string().optional()}),f=e.union([e.literal("active"),e.literal("expired"),e.literal("cancelled"),e.literal("ended")]);e.object({id:e.number(),room_id:e.number(),user_id:e.number(),start_date:e.string(),end_date:e.string(),status:f,created_at:e.string(),deposit:e.number(),room_name:e.string(),user_name:e.string(),branch_name:e.string(),branch_id:e.number()});e.object({room_id:e.number().min(1,{message:"Phòng là bắt buộc."}),user_id:e.number().min(1,{message:"Khách hàng là bắt buộc."}),start_date:e.string().min(1,{message:"Ngày bắt đầu là bắt buộc."}),end_date:e.string().min(1,{message:"Ngày kết thúc là bắt buộc."}),deposit:e.number().min(0,{message:"Tiền cọc phải lớn hơn hoặc bằng 0."}).optional(),branch_id:e.number().min(1,{message:"Chi nhánh là bắt buộc."})});const Q=e.object({id:e.number().optional(),room_id:e.number().min(1,{message:"Phòng là bắt buộc."}),user_id:e.number().min(1,{message:"Khách hàng là bắt buộc."}),start_date:e.string().min(1,{message:"Ngày bắt đầu là bắt buộc."}),end_date:e.string().min(1,{message:"Ngày kết thúc là bắt buộc."}),status:f,deposit:e.number().min(0,{message:"Tiền cọc phải lớn hơn hoặc bằng 0."}).optional(),branch_id:e.number().min(1,{message:"Chi nhánh là bắt buộc."}),isEdit:e.boolean().optional(),occupants:e.array(e.object({user_id:e.number().min(1),relation:e.string().optional(),name:e.string().min(1)})).optional()}),W=e.object({user_id:e.number().min(1,{message:"Người ở là bắt buộc."}),relation:e.string().optional(),name:e.string().optional()});function Y({form:t,handleAddOccupant:g,currentRow:r,users:i,open:s,onOpenChange:c,onAddUserOpen:b}){return n.jsx(_,{open:s,onOpenChange:c,children:n.jsxs(y,{className:"sm:max-w-lg",children:[n.jsxs(v,{className:"text-left",children:[n.jsx(N,{children:"Thêm người ở"}),n.jsxs(S,{children:["Thêm người ở cho phòng ",r==null?void 0:r.name,"."]})]}),n.jsx(C,{className:"-mr-4 h-[20rem] w-full py-1 pr-4",children:n.jsx(T,{...t,children:n.jsxs("form",{id:"occupantForm",onSubmit:t.handleSubmit(g),className:"space-y-4 p-0.5",children:[n.jsx(o,{control:t.control,name:"user_id",render:({field:l})=>n.jsxs(h,{children:[n.jsx(m,{children:"Người ở"}),n.jsxs(F,{onValueChange:a=>{l.onChange(Number(a))},value:l.value.toString(),children:[n.jsx(d,{children:n.jsx(w,{children:n.jsx(A,{placeholder:"Chọn người ở"})})}),n.jsxs(I,{children:[i.map(a=>n.jsx(X,{value:a.id.toString(),children:a.name},a.id)),n.jsxs("a",{href:"#",onClick:a=>{a.preventDefault(),b()},className:"flex items-center px-2 py-1 text-sm text-blue-600 hover:text-blue-800",children:[n.jsx(K,{className:"mr-1 h-4 w-4"}),"Thêm khách mới"]})]})]}),n.jsx(u,{})]})}),n.jsx(o,{control:t.control,name:"relation",render:({field:l})=>n.jsxs(h,{children:[n.jsx(m,{children:"Mối quan hệ"}),n.jsx(d,{children:n.jsx(x,{...l})}),n.jsx(u,{})]})})]})})}),n.jsxs(D,{children:[n.jsx(j,{type:"submit",form:"occupantForm",children:"Xác nhận"}),n.jsx(j,{type:"button",variant:"secondary",onClick:()=>c(!1),children:"Hủy"})]})]})})}function Z({form:t,handleCreateUser:g,open:r,onOpenChange:i}){return n.jsx(_,{open:r,onOpenChange:s=>!t.formState.isSubmitting&&i(s),children:n.jsxs(y,{className:"sm:max-w-lg",children:[n.jsxs(v,{className:"text-left",children:[n.jsx(N,{children:"Thêm khách mới"}),n.jsx(S,{children:"Tạo khách hàng mới tại đây."})]}),n.jsx(C,{className:"-mr-4 w-full py-1 pr-4",children:n.jsx(T,{...t,children:n.jsxs("form",{id:"userForm",onSubmit:t.handleSubmit(g),className:"space-y-4 p-0.5",children:[n.jsx(o,{control:t.control,name:"username",render:({field:s})=>n.jsxs(h,{children:[n.jsx(m,{children:"Tên truy cập"}),n.jsx(d,{children:n.jsx(x,{...s})}),n.jsx(u,{})]})}),n.jsx(o,{control:t.control,name:"name",render:({field:s})=>n.jsxs(h,{children:[n.jsx(m,{children:"Tên"}),n.jsx(d,{children:n.jsx(x,{...s})}),n.jsx(u,{})]})}),n.jsx(o,{control:t.control,name:"email",render:({field:s})=>n.jsxs(h,{children:[n.jsx(m,{children:"Email"}),n.jsx(d,{children:n.jsx(x,{...s})}),n.jsx(u,{})]})}),n.jsx(o,{control:t.control,name:"password",render:({field:s})=>n.jsxs(h,{children:[n.jsx(m,{children:"Mật khẩu"}),n.jsx(d,{children:n.jsx(x,{type:"password",...s})}),n.jsx(u,{})]})}),n.jsx(o,{control:t.control,name:"phone",render:({field:s})=>n.jsxs(h,{children:[n.jsx(m,{children:"Số điện thoại"}),n.jsx(d,{children:n.jsx(x,{...s,value:s.value??"",onChange:c=>s.onChange(c.target.value||null)})}),n.jsx(u,{})]})})]})})}),n.jsxs(D,{children:[n.jsx(j,{type:"submit",form:"userForm",children:"Xác nhận"}),n.jsx(j,{type:"button",variant:"secondary",onClick:()=>i(!1),children:"Hủy"})]})]})})}function $({open:t,onOpenChange:g,contract_id:r,type:i="end_contract"}){const{user:s}=q.getState().auth,c=s==null?void 0:s.role;async function b(){var l,a;if(c!=="admin"&&c!=="owner"){p({title:"Không có quyền",description:"Chỉ admin hoặc owner mới có quyền xóa hợp đồng.",variant:"destructive"});return}try{await H.endContract(r),p({title:i==="end_contract"?"Xóa hợp đồng thành công!":"Trả phòng thành công!"}),g(!1),window.location.reload()}catch(k){p({title:i==="end_contract"?"Xóa hợp đồng thất bại":"Trả phòng thất bại",description:((a=(l=k.response)==null?void 0:l.data)==null?void 0:a.message)||"Lỗi hệ thống, vui lòng thử lại sau",variant:"destructive"})}}return n.jsx(P,{open:t,onOpenChange:g,handleConfirm:b,title:n.jsxs("span",{className:"text-destructive",children:[n.jsx(z,{className:"mr-1 inline-block stroke-destructive",size:18}),i==="end_contract"?"Xóa hợp đồng":"Trả phòng"]}),desc:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("p",{className:"mb-2",children:["Bạn chắc chắn muốn xóa hợp đồng ",i==="end_contract"?n.jsxs("span",{className:"font-bold",children:["# ",r]}):"trả phòng"," ?",n.jsx("br",{}),"Hành động này sẽ:"]}),n.jsxs("ul",{className:"list-disc pl-5 py-2",children:[n.jsx("li",{children:"Xóa hợp đồng và các thông tin liên quan."}),n.jsx("li",{children:'Cập nhật trạng thái phòng về "Trống ".'}),n.jsx("li",{children:"Xóa các thanh toán và hóa đơn liên quan."})]}),n.jsxs(B,{variant:"destructive",children:[n.jsx(E,{children:"Cảnh báo!"}),n.jsx(M,{children:"Cẩn trọng, hành động này không thể hoàn tác."})]})]}),confirmText:"Xác nhận",destructive:!0})}export{$ as C,Y as D,Z as a,Q as b,J as c,W as o};
