import{a1 as y,b as F,e as D,t as k,z as c,r as v,j as e,F as Y,g as d,h as u,i as m,k as g,I as p,au as b,l as x,B as C,n as j,o as f,c as M}from"./index-ChY-99TT.js";import{C as N}from"./content-section-ChENuYIM.js";import{u as S}from"./useMutation-dErWOMDE.js";const L=["032","033","034","035","036","037","038","039","070","071","072","076","077","078","079","089","090","093","081","082","083","084","085","087","088","091","094","052","056","057","058","059","092","099"],P=new RegExp(`^(${L.join("|")})\\d{7}$`),w=c.object({username:c.string().min(2,{message:"Tên người dùng phải có ít nhất 2 ký tự."}).max(30,{message:"Tên người dùng không được dài quá 30 ký tự."}),email:c.string().email({message:"Vui lòng nhập địa chỉ email hợp lệ."}),phone:c.string().optional().refine(r=>r?P.test(r):!0,{message:"Số điện thoại không hợp lệ."}),dob:c.string().regex(/^\d{2}-\d{2}-\d{4}$/,{message:"Ngày sinh phải có định dạng DD-MM-YYYY."}).refine(r=>{const[t,s,o]=r.split("-").map(Number),i=new Date(o,s-1,t);return!isNaN(i.getTime())&&i.getDate()===t&&i.getMonth()===s-1&&i.getFullYear()===o&&i<=new Date&&i>=new Date("1900-01-01")},{message:"Ngày sinh không hợp lệ hoặc ngoài khoảng cho phép (1900 đến hiện tại)."})}),E={username:"",email:"",phone:"",dob:""};function T(){const r=y(),t=F(),s=D({resolver:k(w),defaultValues:E,mode:"onChange"});v.useEffect(()=>{if(t.user){const n=t.user.dob||"",h=n?n.split("-").reverse().join("-"):"";let a=t.user.phone||"";a.startsWith("+84")&&a.length===12&&(a="0"+a.slice(3));const l={username:t.user.name||t.user.username||"",email:t.user.email||"",phone:t.user.phone||"",dob:h};s.reset(l)}},[t.user,s]);const o=S({mutationFn:n=>f.updateUser(n),onSuccess:async()=>{j({title:"Cập nhật thông tin thành công!"});try{const n=await f.getCurrentUser();if(t.accessToken&&n){const{data:h}=n;t.setAuth(h.user,t.accessToken)}}catch(n){j({variant:"destructive",title:"Lỗi khi đồng bộ người dùng",description:n.message||"Không thể cập nhật thông tin người dùng."})}r.invalidateQueries({queryKey:["currentUser"]})},onError:n=>{j({variant:"destructive",title:"Lỗi khi cập nhật thông tin",description:n.message,duration:5e3})}}),i=n=>{var l;if(!((l=t.user)!=null&&l.id)){j({variant:"destructive",title:"Lỗi",description:"Không tìm thấy thông tin người dùng.",duration:5e3});return}const h=n.dob.split("-").reverse().join("-"),a={id:t.user.id,name:n.username,email:n.email,phone:n.phone,dob:h};o.mutate(a)};return t.user?e.jsx(Y,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(i),className:"space-y-8",children:[e.jsx(d,{control:s.control,name:"username",render:({field:n})=>e.jsxs(u,{children:[e.jsx(m,{children:"Tên người dùng"}),e.jsx(g,{children:e.jsx(p,{placeholder:"Le Van A",...n})}),e.jsx(b,{children:"Đây là tên hiển thị công khai của bạn. Có thể là tên thật hoặc bút danh."}),e.jsx(x,{})]})}),e.jsx(d,{control:s.control,name:"email",render:({field:n})=>e.jsxs(u,{children:[e.jsx(m,{children:"Email"}),e.jsx(g,{children:e.jsx(p,{placeholder:"example@nttn.com",type:"email",...n})}),e.jsx(x,{})]})}),e.jsx(d,{control:s.control,name:"phone",render:({field:n})=>e.jsxs(u,{children:[e.jsx(m,{children:"Số điện thoại"}),e.jsx(g,{children:e.jsx(p,{placeholder:"Ví dụ: 0123456789",...n})}),e.jsx(b,{children:"Nhập số điện thoại hợp lệ."}),e.jsx(x,{})]})}),e.jsx(d,{control:s.control,name:"dob",render:({field:n})=>e.jsxs(u,{children:[e.jsx(m,{children:"Ngày sinh"}),e.jsx(g,{children:e.jsx(p,{placeholder:"DD-MM-YYYY",...n})}),e.jsx(b,{children:"Nhập ngày sinh theo định dạng DD-MM-YYYY (ví dụ: 01-01-1990)."}),e.jsx(x,{})]})}),e.jsx(C,{type:"submit",disabled:o.isPending,children:o.isPending?"Đang lưu...":"Lưu thay đổi"})]})}):e.jsx("div",{children:"Không tìm thấy thông tin người dùng. Vui lòng đăng nhập lại."})}function V(){return e.jsx(N,{title:"Hồ sơ",desc:"Đây là cách người khác nhìn thấy bạn trên trang web.",children:e.jsx(T,{})})}const q=M("/_authenticated/settings/")({component:V});export{q as Route};
