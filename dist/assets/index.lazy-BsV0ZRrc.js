import{V as pe,j as e,r as w,W as ve,z as O,a3 as Q,a4 as G,a5 as $,a6 as J,a7 as W,y as Y,F as Z,g as f,h as N,i as v,k as T,I as D,l as _,S as L,s as M,v as q,w as A,x as b,aa as ee,B as C,a1 as ye,as as De,o as k,n as y,ar as Fe,av as ne,b as ie,e as z,t as H,a2 as B,H as Oe,E as Ve,T as Re,J as Le,M as Me,aw as qe,ax as Ae,ay as oe,az as de,C as he,aA as xe,aB as me,aC as ue,at as ge,c as Ke}from"./index-CJ1AcNxb.js";import{A as be,a as Ce,b as fe,C as Ie}from"./alert-bq5yZ8aI.js";import{u as Pe,I as te,a as Xe,b as ze,e as He,i as Ee}from"./index-BcGaQFY_.js";import{c as Ue,o as Be,D as Qe,a as Ge,C as $e}from"./contracts-delete-dialog-CTQ7TwOz.js";import{u as Je}from"./schema-C2tS-PoL.js";import{r as We}from"./schema-DFUXsWFl.js";import{I as ae}from"./IconPlus-DrlgcPqJ.js";import{I as Ye}from"./IconAlertTriangle-VRRGoB_F.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ze=pe("outline","database-off","IconDatabaseOff",[["path",{d:"M12.983 8.978c3.955 -.182 7.017 -1.446 7.017 -2.978c0 -1.657 -3.582 -3 -8 -3c-1.661 0 -3.204 .19 -4.483 .515m-2.783 1.228c-.471 .382 -.734 .808 -.734 1.257c0 1.22 1.944 2.271 4.734 2.74",key:"svg-0"}],["path",{d:"M4 6v6c0 1.657 3.582 3 8 3c.986 0 1.93 -.067 2.802 -.19m3.187 -.82c1.251 -.53 2.011 -1.228 2.011 -1.99v-6",key:"svg-1"}],["path",{d:"M4 12v6c0 1.657 3.582 3 8 3c3.217 0 5.991 -.712 7.261 -1.74m.739 -3.26v-4",key:"svg-2"}],["path",{d:"M3 3l18 18",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var je=pe("outline","home-plus","IconHomePlus",[["path",{d:"M19 12h2l-9 -9l-9 9h2v7a2 2 0 0 0 2 2h5.5",key:"svg-0"}],["path",{d:"M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2",key:"svg-1"}],["path",{d:"M16 19h6",key:"svg-2"}],["path",{d:"M19 16v6",key:"svg-3"}]]);function es(){return e.jsx("div",{className:"col-span-12 flex justify-center items-center h-64",children:e.jsxs(be,{className:"max-w-md text-center",children:[e.jsx(Ze,{className:"h-5 w-5 mx-auto mb-2 text-muted-foreground"}),e.jsx(Ce,{className:"text-lg",children:"Không có dữ liệu"}),e.jsx(fe,{className:"text-sm text-muted-foreground",children:"Hệ thống hiện không có dữ liệu để hiển thị."})]})})}const ss=[{accessorKey:"id",header:"ID",meta:{className:"w-[100px]"}},{accessorKey:"name",header:"Tên phòng",meta:{className:"w-[200px]"}},{accessorKey:"price",header:"Giá (VNĐ)",meta:{className:"w-[150px]"},cell:({row:s})=>s.original.price.toLocaleString("vi-VN")},{accessorKey:"status",header:"Trạng thái",meta:{className:"w-[150px]"}}],Ne=ve.createContext(null);function ns({children:s}){const[m,n]=Pe(null),[u,c]=w.useState(null),[h,a]=w.useState(null);return e.jsx(Ne.Provider,{value:{open:m,setOpen:n,currentRow:u,setCurrentRow:c,previousOpen:h,setPreviousOpen:a},children:s})}const K=()=>{const s=ve.useContext(Ne);if(!s)throw new Error("useRooms has to be used within <RoomsContext>");return s};O.object({id:O.number(),name:O.string(),description:O.string().optional(),branch_id:O.number()});const ts=O.object({name:O.string().min(1,{message:"Tên loại phòng là bắt buộc."}),description:O.string().optional(),branch_id:O.number().min(1,{message:"Chi nhánh là bắt buộc."})});function as({form:s,handleSaveRoom:m,branches:n,roomTypes:u}){const{open:c,setOpen:h}=K();return c==="addRoom"&&e.jsx(Q,{open:!0,onOpenChange:()=>h(null),children:e.jsxs(G,{className:"sm:max-w-lg",children:[e.jsxs($,{className:"text-left",children:[e.jsx(J,{children:"Thêm phòng mới"}),e.jsx(W,{children:"Nhập thông tin để thêm phòng mới."})]}),e.jsx(Y,{className:"-mr-4 w-full py-1 pr-4",children:e.jsx(Z,{...s,children:e.jsxs("form",{id:"roomForm",onSubmit:s.handleSubmit(m),className:"space-y-4 p-0.5",children:[e.jsx(f,{control:s.control,name:"name",render:({field:a})=>e.jsxs(N,{children:[e.jsx(v,{children:"Tên phòng"}),e.jsx(T,{children:e.jsx(D,{...a})}),e.jsx(_,{})]})}),e.jsx(f,{control:s.control,name:"price",render:({field:a})=>e.jsxs(N,{children:[e.jsx(v,{children:"Giá (VNĐ)"}),e.jsx(T,{children:e.jsx(D,{type:"number",...a,onChange:i=>a.onChange(Number(i.target.value))})}),e.jsx(_,{})]})}),e.jsx(f,{control:s.control,name:"status",render:({field:a})=>e.jsxs(N,{children:[e.jsx(v,{children:"Trạng thái"}),e.jsxs(L,{onValueChange:a.onChange,value:a.value,children:[e.jsx(T,{children:e.jsx(M,{children:e.jsx(q,{placeholder:"Chọn trạng thái"})})}),e.jsxs(A,{children:[e.jsx(b,{value:"occupied",children:"Đã thuê"}),e.jsx(b,{value:"available",children:"Trống"}),e.jsx(b,{value:"maintenance",children:"Bảo trì"})]})]}),e.jsx(_,{})]})}),e.jsx(f,{control:s.control,name:"branch_id",render:({field:a})=>e.jsxs(N,{children:[e.jsx(v,{children:"Chi nhánh"}),e.jsxs(L,{onValueChange:i=>a.onChange(Number(i)),value:a.value.toString(),children:[e.jsx(T,{children:e.jsx(M,{children:e.jsx(q,{placeholder:"Chọn chi nhánh"})})}),e.jsx(A,{children:n.length===0?e.jsx(b,{value:"0",disabled:!0,children:"Đang tải chi nhánh..."}):n.map(i=>e.jsx(b,{value:i.id.toString(),children:i.name},i.id))})]}),e.jsx(_,{})]})}),e.jsx(f,{control:s.control,name:"type_id",render:({field:a})=>e.jsxs(N,{children:[e.jsx(v,{children:"Loại phòng"}),e.jsxs(L,{onValueChange:i=>a.onChange(Number(i)),value:a.value.toString(),children:[e.jsx(T,{children:e.jsx(M,{children:e.jsx(q,{placeholder:"Chọn loại phòng"})})}),e.jsxs(A,{children:[u.length===0?e.jsx(b,{value:"0",disabled:!0,children:"Đang tải loại phòng..."}):u.map(i=>e.jsx(b,{value:i.id.toString(),children:i.name},i.id)),e.jsxs("a",{href:"#",onClick:i=>{i.preventDefault(),h("addRoomType")},className:"flex items-center px-2 py-1 text-sm text-blue-600 hover:text-blue-800",children:[e.jsx(ae,{className:"mr-1 h-4 w-4"}),"Thêm loại phòng mới"]})]})]}),e.jsx(_,{})]})})]})})}),e.jsxs(ee,{children:[e.jsx(C,{type:"submit",form:"roomForm",disabled:!s.formState.isValid,children:"Xác nhận"}),e.jsx(C,{variant:"secondary",onClick:()=>h(null),children:"Hủy"})]})]})})}function is({form:s,handleCreateRoomType:m,branches:n}){const{open:u,setOpen:c}=K();return u==="addRoomType"&&e.jsx(Q,{open:!0,onOpenChange:()=>c(null),children:e.jsxs(G,{className:"sm:max-w-lg",children:[e.jsxs($,{className:"text-left",children:[e.jsx(J,{children:"Thêm loại phòng"}),e.jsx(W,{children:"Tạo loại phòng mới tại đây."})]}),e.jsx(Y,{className:"-mr-4 h-[20rem] w-full py-1 pr-4",children:e.jsx(Z,{...s,children:e.jsxs("form",{id:"roomTypeForm",onSubmit:s.handleSubmit(m),className:"space-y-4 p-0.5",children:[e.jsx(f,{control:s.control,name:"name",render:({field:h})=>e.jsxs(N,{children:[e.jsx(v,{children:"Tên loại phòng"}),e.jsx(T,{children:e.jsx(D,{...h})}),e.jsx(_,{})]})}),e.jsx(f,{control:s.control,name:"description",render:({field:h})=>e.jsxs(N,{children:[e.jsx(v,{children:"Mô tả"}),e.jsx(T,{children:e.jsx(D,{...h})}),e.jsx(_,{})]})}),e.jsx(f,{control:s.control,name:"branch_id",render:({field:h})=>e.jsxs(N,{children:[e.jsx(v,{children:"Chi nhánh"}),e.jsxs(L,{onValueChange:a=>h.onChange(Number(a)),value:h.value.toString(),children:[e.jsx(T,{children:e.jsx(M,{children:e.jsx(q,{placeholder:"Chọn chi nhánh"})})}),e.jsx(A,{children:n.length===0?e.jsx(b,{value:"0",disabled:!0,children:"Đang tải chi nhánh..."}):n.map(a=>e.jsx(b,{value:a.id.toString(),children:a.name},a.id))})]}),e.jsx(_,{})]})})]})})}),e.jsx(ee,{children:e.jsx(C,{type:"submit",form:"roomTypeForm",disabled:!s.formState.isValid,children:"Xác nhận"})})]})})}function ls({form:s,handleCreateContract:m,currentRow:n,users:u,occupants:c,handleDeleteOppupant:h}){const{open:a,setOpen:i,setCurrentRow:t,setPreviousOpen:S}=K();return n&&a==="contract"&&e.jsx(Q,{open:!0,onOpenChange:()=>{i(null),t(null)},children:e.jsxs(G,{className:"sm:max-w-lg",children:[e.jsxs($,{className:"text-left",children:[e.jsxs(J,{children:["Tạo hợp đồng cho phòng: ",n.name]}),e.jsx(W,{children:"Chọn khách hàng hoặc thêm khách mới."})]}),e.jsx(Y,{className:"-mr-4 w-full py-1 pr-4",children:e.jsx(Z,{...s,children:e.jsxs("form",{id:"contractForm",onSubmit:s.handleSubmit(m),className:"space-y-4 p-0.5",children:[e.jsx(f,{control:s.control,name:"user_id",render:({field:l})=>e.jsxs(N,{children:[e.jsx(v,{children:"Khách hàng"}),e.jsxs(L,{onValueChange:g=>l.onChange(Number(g)),value:l.value.toString(),children:[e.jsx(T,{children:e.jsx(M,{children:e.jsx(q,{placeholder:"Chọn khách hàng"})})}),e.jsxs(A,{children:[u.map(g=>e.jsx(b,{value:g.id.toString(),children:g.name},g.id)),e.jsxs("a",{href:"#",onClick:g=>{g.preventDefault(),S("contract"),i("addUser")},className:"flex items-center px-2 py-1 text-sm text-blue-600 hover:text-blue-800",children:[e.jsx(ae,{className:"mr-1 h-4 w-4"}),"Thêm khách mới"]})]})]}),e.jsx(_,{})]})}),e.jsx(f,{control:s.control,name:"start_date",render:({field:l})=>e.jsxs(N,{children:[e.jsx(v,{children:"Ngày bắt đầu"}),e.jsx(T,{children:e.jsx(D,{type:"date",...l})}),e.jsx(_,{})]})}),e.jsx(f,{control:s.control,name:"end_date",render:({field:l})=>e.jsxs(N,{children:[e.jsx(v,{children:"Ngày kết thúc"}),e.jsx(T,{children:e.jsx(D,{type:"date",...l})}),e.jsx(_,{})]})}),e.jsx(f,{control:s.control,name:"deposit",render:({field:l})=>e.jsxs(N,{children:[e.jsx(v,{children:"Tiền cọc (VNĐ)"}),e.jsx(T,{children:e.jsx(D,{type:"number",...l,onChange:g=>l.onChange(Number(g.target.value))})}),e.jsx(_,{})]})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(v,{children:"Người ở cùng"}),e.jsxs(C,{type:"button",variant:"outline",size:"sm",onClick:()=>{S("contract"),i("addOccupant")},children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Thêm người ở cùng"]})]}),c.length===0?e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Không có người ở cùng."}):e.jsx("ul",{className:"space-y-2",children:c.map((l,g)=>{var o;return e.jsxs("li",{className:"flex items-center justify-between border rounded px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((o=u.find(j=>Number(j.id)===l.user_id))==null?void 0:o.name)||"Không rõ tên"}),e.jsx("p",{className:"text-xs italic text-muted-foreground",children:l.relation})]}),e.jsx(C,{type:"button",variant:"ghost",size:"icon",onClick:()=>h(l.user_id),children:e.jsx(te,{className:"w-4 h-4 text-red-500"})})]},g)})})]})]})})}),e.jsxs(ee,{children:[e.jsx(C,{type:"submit",disabled:!s.formState.isValid,form:"contractForm",children:"Xác nhận"}),e.jsx(C,{variant:"secondary",onClick:()=>{i(null),t(null)},children:"Hủy"})]})]})})}function rs({open:s,onOpenChange:m,currentRow:n,page:u,limit:c,selectedBranchId:h}){const[a,i]=w.useState(""),t=ye();async function S(){var l,g;if(!(!n||a.trim()!==n.name))try{await k.deleteRoom(n.id),t.invalidateQueries({queryKey:["rooms",u,c,h]}),y({title:"Xóa phòng thành công!"})}catch(o){y({title:"Xóa phòng thất bại",description:((g=(l=o.response)==null?void 0:l.data)==null?void 0:g.message)||"Lỗi hệ thống, vui lòng thử lại sau",variant:"destructive"})}finally{i(""),m(!1)}}return e.jsx(Ie,{open:s,onOpenChange:m,handleConfirm:S,disabled:a.trim()!==(n==null?void 0:n.name),title:e.jsxs("span",{className:"text-destructive",children:[e.jsx(Ye,{className:"mr-1 inline-block stroke-destructive",size:18})," Xóa phòng"]}),desc:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"mb-2",children:["Bạn chắc chắn muốn xóa phòng ",e.jsx("span",{className:"font-bold",children:n==null?void 0:n.name}),"?",e.jsx("br",{}),"Hành động này sẽ xóa hết các thông tin liên quan đến phòng, bao gồm:"]}),e.jsxs("ul",{className:"list-disc pl-5 py-2",children:[e.jsx("li",{children:"Xóa tất cả hợp đồng liên quan đến phòng."}),e.jsx("li",{children:"Xóa tất cả thanh toán liên quan đến hợp đồng."}),e.jsx("li",{children:"Xóa các dịch vụ phòng, yêu cầu bảo trì, và thông tin người ở liên quan."})]}),e.jsxs(De,{className:"py-2",children:[e.jsx("span",{className:"font-bold",children:"Xác nhận:"}),e.jsx(D,{value:a,onChange:l=>i(l.target.value),placeholder:`Gõ vào \`${n==null?void 0:n.name}\` để xác nhận xóa`})]}),e.jsxs(be,{variant:"destructive",children:[e.jsx(Ce,{children:"Cảnh báo!"}),e.jsx(fe,{children:"Cẩn trọng, hành động này không thể hoàn tác."})]})]}),confirmText:"Xóa",destructive:!0})}function cs({form:s,handleSaveRoom:m,currentRow:n,isEditMode:u,setIsEditMode:c,branches:h,roomTypes:a}){const{open:i,setOpen:t,setCurrentRow:S}=K(),{user:l}=Fe.getState().auth,g=l==null?void 0:l.role;return n&&i==="viewRoom"&&e.jsx(Q,{open:!0,onOpenChange:()=>{t(null),S(null)},children:e.jsxs(G,{className:"sm:max-w-lg",children:[e.jsxs($,{className:"text-left",children:[e.jsxs(J,{children:["Phòng: ",n.name]}),e.jsx(W,{children:u?"Chỉnh sửa thông tin phòng.":"Xem chi tiết phòng."})]}),e.jsx(Y,{className:"-mr-4 w-full py-1 pr-4",children:u?e.jsx(Z,{...s,children:e.jsxs("form",{id:"roomForm",onSubmit:s.handleSubmit(m),className:"space-y-4 p-0.5",children:[e.jsx(f,{control:s.control,name:"name",render:({field:o})=>e.jsxs(N,{children:[e.jsx(v,{children:"Tên phòng"}),e.jsx(T,{children:e.jsx(D,{...o})}),e.jsx(_,{})]})}),e.jsx(f,{control:s.control,name:"price",render:({field:o})=>e.jsxs(N,{children:[e.jsx(v,{children:"Giá (VNĐ)"}),e.jsx(T,{children:e.jsx(D,{type:"number",...o,onChange:j=>o.onChange(Number(j.target.value))})}),e.jsx(_,{})]})}),e.jsx(f,{control:s.control,name:"status",render:({field:o})=>e.jsxs(N,{children:[e.jsx(v,{children:"Trạng thái"}),e.jsxs(L,{onValueChange:o.onChange,value:o.value,children:[e.jsx(T,{children:e.jsx(M,{children:e.jsx(q,{placeholder:"Chọn trạng thái"})})}),e.jsxs(A,{children:[e.jsx(b,{value:"occupied",children:"Đã thuê"}),e.jsx(b,{value:"available",children:"Trống"}),e.jsx(b,{value:"maintenance",children:"Bảo trì"})]})]}),e.jsx(_,{})]})}),e.jsx(f,{control:s.control,name:"branch_id",render:({field:o})=>e.jsxs(N,{children:[e.jsx(v,{children:"Chi nhánh"}),e.jsxs(L,{onValueChange:j=>o.onChange(Number(j)),value:o.value.toString(),children:[e.jsx(T,{children:e.jsx(M,{children:e.jsx(q,{placeholder:"Chọn chi nhánh"})})}),e.jsx(A,{children:h.length===0?e.jsx(b,{value:"0",disabled:!0,children:"Không có chi nhánh nào"}):h.map(j=>e.jsx(b,{value:j.id.toString(),children:j.name},j.id))})]}),e.jsx(_,{})]})}),e.jsx(f,{control:s.control,name:"type_id",render:({field:o})=>e.jsxs(N,{children:[e.jsx(v,{children:"Loại phòng"}),e.jsxs(L,{onValueChange:j=>o.onChange(Number(j)),value:o.value.toString(),children:[e.jsx(T,{children:e.jsx(M,{children:e.jsx(q,{placeholder:"Chọn loại phòng"})})}),e.jsx(A,{children:a.length===0?e.jsx(b,{value:"0",disabled:!0,children:"Không có loại phòng nào"}):a.map(j=>e.jsx(b,{value:j.id.toString(),children:j.name},j.id))})]}),e.jsx(_,{})]})})]})}):e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"ID:"})," ",n.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tên:"})," ",n.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Chi nhánh:"})," ",n.branch_name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Loại:"})," ",n.type_name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Giá:"})," ",parseFloat(n.price.toString()).toLocaleString()," VNĐ"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Trạng thái:"})," ",ne[n.status]||n.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ngày tạo:"})," ",new Date(n.created_at).toLocaleDateString()]})]})}),e.jsx(ee,{children:u?e.jsxs(e.Fragment,{children:[e.jsx(C,{type:"submit",form:"roomForm",disabled:!s.formState.isValid,children:"Lưu thay đổi"},"luu-thay-doi"),e.jsx(C,{type:"button",variant:"secondary",onClick:()=>{t(null),S(null)},children:"Đóng"})]}):g!=="customer"&&e.jsxs(e.Fragment,{children:[e.jsx(C,{type:"button",onClick:()=>c(!0),children:"Chỉnh sửa"},"chinh-sua"),e.jsx(C,{type:"button",variant:"secondary",onClick:()=>{t(null),S(null)},children:"Đóng"}),n.status==="available"&&e.jsx(C,{type:"button",variant:"secondary",onClick:()=>t("contract"),children:"Tạo hợp đồng"}),n.status==="occupied"&&e.jsx(C,{type:"button",variant:"secondary",onClick:()=>t("release_room"),children:"Trả phòng"})]})})]})})}const os=w.memo(function({selectedBranchId:m,page:n,limit:u,branches:c=[]}){const h=ye(),{open:a,setOpen:i,currentRow:t,setCurrentRow:S,previousOpen:l,setPreviousOpen:g}=K(),[o,j]=w.useState([]),{user:I}=ie(),[V,P]=w.useState(!1),E=z({resolver:H(ts),defaultValues:{name:"",description:"",branch_id:c.length>0?c[0].id:0}}),R=z({resolver:H(We),defaultValues:{id:0,name:"",price:0,status:"available",branch_id:0,type_id:0}}),F=z({resolver:H(Ue),defaultValues:{room_id:0,user_id:0,start_date:"",end_date:"",deposit:0}}),U=z({resolver:H(Be),defaultValues:{user_id:0,relation:""}}),r=z({resolver:H(Je),defaultValues:{username:"",email:"",password:"",role:"customer",name:"",phone:""}}),{data:p}=B({queryKey:["roomTypes"],queryFn:()=>k.getAllRoomTypes()}),{data:se}=B({queryKey:["users",{role:"customer"}],queryFn:()=>k.getAllUsers({role:"customer",page:n,limit:u})}),le=(p==null?void 0:p.data)||[],re=(se==null?void 0:se.data)||[];w.useEffect(()=>{t?R.reset({id:t.id,name:t.name,price:parseFloat(t.price.toString()),status:t.status,branch_id:t.branch_id,type_id:t.type_id}):R.reset({id:0,name:"",price:0,status:((I==null?void 0:I.role)==="owner","available"),branch_id:c.length>0?c[0].id:0,type_id:0}),t?F.reset({room_id:t.id,user_id:0,start_date:"",end_date:"",deposit:0}):F.reset({room_id:0,user_id:0,start_date:"",end_date:"",deposit:0})},[t,c,I,R,F]),w.useEffect(()=>{P(!1)},[a]);const Te=async d=>{try{await k.createRoomType(d),h.invalidateQueries({queryKey:["roomTypes"]}),y({title:"Tạo loại phòng thành công!"}),i(null)}catch(x){y({title:"Tạo loại phòng thất bại",description:x.message,variant:"destructive"})}},ce=async d=>{try{t&&V?(await k.updateRoom({id:d.id,name:d.name,price:d.price,status:d.status,branch_id:d.branch_id,type_id:d.type_id}),y({title:"Cập nhật phòng thành công!"})):(await k.createRoom({name:d.name,price:d.price,status:d.status,branch_id:d.branch_id,type_id:d.type_id}),y({title:"Thêm phòng mới thành công!"})),h.invalidateQueries({queryKey:["rooms",n,u,m]}),i(null),S(null)}catch(x){y({title:t&&V?"Cập nhật phòng thất bại":"Thêm phòng thất bại",description:x.message,variant:"destructive"})}},_e=async d=>{if(t){if(d.user_id===0){y({title:"Vui lòng chọn khách hàng hoặc thêm khách mới!",variant:"destructive"});return}try{const x=await k.createContract({...d,branch_id:t.branch_id});if(!x||x.status!=="success")throw new Error("Tạo hợp đồng thất bại");if((await k.addRoomOccupant(t.id,o)).status!=="success")throw new Error("Thêm người ở cùng thất bại");h.invalidateQueries({queryKey:["rooms",n,u]}),y({title:"Tạo hợp đồng thành công!"}),i(null),S(null),g(null),j([]),F.reset()}catch(x){let X=x.message;x.response&&x.response.data&&x.response.data.message&&(X=x.response.data.message),y({title:"Tạo hợp đồng thất bại",description:X,variant:"destructive"})}}},Se=async d=>{try{y({title:"Thêm người ở thành công!"}),j(x=>[...x,d]),U.reset(),i(l==="addOccupant"?"contract":l)}catch(x){y({title:"Thêm người ở thất bại",description:x.message,variant:"destructive"})}},ke=async d=>{try{const x=await k.createUser(d);h.invalidateQueries({queryKey:["users",{role:"customer"}]}),F.setValue("user_id",Number(x.data.id)),y({title:"Tạo khách mới thành công!"}),i(l),r.reset()}catch(x){y({title:"Tạo khách mới thất bại",description:x.message,variant:"destructive"})}},we=async d=>{try{y({title:"Xóa người ở thành công!"}),j(x=>x.filter(X=>X.user_id!==d))}catch(x){y({title:"Xóa người ở thất bại",description:x.message,variant:"destructive"})}};return e.jsxs(e.Fragment,{children:[a==="addRoomType"&&e.jsx(is,{form:E,handleCreateRoomType:Te,branches:c}),a==="addRoom"&&e.jsx(as,{form:R,handleSaveRoom:ce,branches:c,roomTypes:le}),a==="viewRoom"&&t&&e.jsx(cs,{form:R,handleSaveRoom:ce,currentRow:t,isEditMode:V,setIsEditMode:P,branches:c,roomTypes:le}),a==="contract"&&t&&e.jsx(ls,{form:F,handleCreateContract:_e,currentRow:t,users:re,occupants:o,handleDeleteOppupant:we}),a==="deleteRoom"&&t&&e.jsx(rs,{open:a==="deleteRoom",onOpenChange:d=>i(d?"deleteRoom":null),currentRow:t,page:n,limit:u,selectedBranchId:m}),a==="addOccupant"&&e.jsx(Qe,{form:U,handleAddOccupant:Se,currentRow:t,users:re,open:!0,onOpenChange:d=>i(l||(d?"addOccupant":null)),onAddUserOpen:()=>{g("addOccupant"),i("addUser")}}),a==="addUser"&&e.jsx(Ge,{form:r,handleCreateUser:ke,open:!0,onOpenChange:d=>i(l||(d?"addUser":null))}),(t==null?void 0:t.contract_id)&&a==="release_room"&&e.jsx($e,{open:!0,onOpenChange:()=>i("viewRoom"),contract_id:t.contract_id,type:"release_room"},`contract-delete-${t==null?void 0:t.contract_id}`)]})});function ds(){const{setOpen:s}=K(),{user:m}=ie();return((m==null?void 0:m.role)||"customer")==="customer"?null:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{className:"space-x-1",onClick:()=>s("addRoom"),children:[e.jsx("span",{children:"Thêm phòng"})," ",e.jsx(je,{size:18})]}),e.jsxs(C,{className:"space-x-1",onClick:()=>s("addRoomType"),children:[e.jsx("span",{children:"Thêm loại phòng"})," ",e.jsx(je,{size:18})]})]})}function hs(){const[s,m]=w.useState(1),[n,u]=w.useState(10),[c,h]=w.useState(null),{setOpen:a,setCurrentRow:i}=K(),{user:t}=ie(),S=(t==null?void 0:t.role)==="owner"||(t==null?void 0:t.role)==="admin",{data:l,isLoading:g}=B({queryKey:["branches"],queryFn:()=>k.getAllBranches({page:1,limit:100})}),{data:o,isLoading:j,error:I}=B({queryKey:["rooms",s,n,c],queryFn:()=>{var r;return k.getAllRooms({page:s,limit:n,filters:c?{branchName:((r=l==null?void 0:l.data.find(p=>p.id===c))==null?void 0:r.name)||""}:{}})},staleTime:5*60*1e3,retry:2,placeholderData:r=>r});I&&y({variant:"destructive",title:"Lỗi khi tải danh sách phòng",description:I.message,duration:5e3});const V=(o==null?void 0:o.data)||[],P=(l==null?void 0:l.data)||[],E=(o==null?void 0:o.pagination)||{total_pages:1,total_records:0},R=r=>{i(r),a("viewRoom")},F=r=>{i(r),a("deleteRoom")},U=Xe({data:V,columns:ss,manualPagination:!0,pageCount:E.total_pages,state:{pagination:{pageIndex:s-1,pageSize:n}},getCoreRowModel:Ee(),getPaginationRowModel:He(),onPaginationChange:()=>{}});return e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{fixed:!0,children:[e.jsx(Ve,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Re,{}),e.jsx(Le,{})]})]}),e.jsx(Me,{children:j&&!o?e.jsx("div",{className:"flex h-full items-center justify-center flex-1",children:"Đang tải phòng..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex flex-col items-start space-y-2 w-full lg:w-auto lg:mr-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Danh sách phòng"}),e.jsx("p",{className:"text-muted-foreground",children:"Quản lý phòng theo chi nhánh."})]}),g?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Đang tải danh sách chi nhánh..."})}):e.jsx(ds,{})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs(qe,{value:(c==null?void 0:c.toString())??"all",onValueChange:r=>{h(r==="all"?null:parseInt(r)),m(1)},className:"w-full flex flex-col",children:[e.jsxs(Ae,{className:"flex justify-start items-center h-auto overflow-auto gap-2 flex-row w-auto lg:space-x-2 space-y-2 lg:space-y-0 bg-transparent",children:[e.jsx(oe,{value:"all",className:"flex-1 lg:flex-none bg-gray-100 rounded-lg py-2 px-4 lg:rounded text-left lg:text-center data-[state=active]:bg-gray-300 data-[state=active]:text-black",children:"Tất cả"}),P.map(r=>e.jsx(oe,{value:r.id.toString(),className:"flex-1 !mt-0 lg:flex-none bg-gray-100 rounded-lg py-2 px-4 lg:rounded text-left lg:text-center data-[state=active]:bg-gray-300 data-[state=active]:text-black",children:r.name},r.id))]}),e.jsxs("div",{className:"flex-1 mt-2",children:[e.jsx(de,{value:"all",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:V.map(r=>e.jsxs(he,{className:`relative cursor-pointer hover:shadow-md ${xe[r.status]||"bg-gray-100"}`,children:[e.jsxs("div",{onClick:()=>R(r),children:[e.jsx(me,{children:e.jsx(ue,{children:r.name})}),e.jsxs(ge,{className:"text-sm text-muted-foreground hidden lg:block",children:[e.jsxs("p",{children:["Loại: ",r.type_name]}),e.jsxs("p",{children:["Chi nhánh: ",r.branch_name]}),e.jsxs("p",{children:["Giá: ",parseFloat(r.price.toString()).toLocaleString()," VNĐ"]}),e.jsxs("p",{children:["Trạng thái: ",ne[r.status]||r.status]})]})]}),S&&e.jsx(C,{variant:"destructive",size:"sm",className:"absolute top-2 right-2 h-10 w-10 rounded-full",onClick:()=>F(r),children:e.jsx(te,{className:"h-4 w-4"})})]},r.id))})}),P.map(r=>e.jsx(de,{value:r.id.toString(),children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:V.filter(p=>p.branch_id===r.id).length===0?e.jsx(es,{}):V.filter(p=>p.branch_id===r.id).map(p=>e.jsxs(he,{className:`relative cursor-pointer hover:shadow-md ${xe[p.status]||"bg-gray-100"}`,children:[e.jsxs("div",{onClick:()=>R(p),children:[e.jsx(me,{children:e.jsx(ue,{children:p.name})}),e.jsxs(ge,{className:"text-sm text-muted-foreground hidden lg:block",children:[e.jsxs("p",{children:["Loại: ",p.type_name]}),e.jsxs("p",{children:["Chi nhánh: ",p.branch_name]}),e.jsxs("p",{children:["Giá: ",parseFloat(p.price.toString()).toLocaleString()," VNĐ"]}),e.jsxs("p",{children:["Trạng thái: ",ne[p.status]||p.status]})]})]}),S&&e.jsx(C,{variant:"destructive",size:"sm",className:"absolute top-2 right-2 h-10 w-10 rounded-full",onClick:()=>F(p),children:e.jsx(te,{className:"h-4 w-4"})})]},p.id))})},r.id))]})]}),e.jsx(ze,{showSelected:!1,table:U,setPage:m,setLimit:u,totalRecords:E.total_records})]})]})}),K().open&&e.jsx(os,{selectedBranchId:c,branches:P,page:s,limit:n})]})}function xs(){return e.jsx(ns,{children:e.jsx(hs,{})})}const Cs=Ke("/_authenticated/rooms/")({component:xs});export{Cs as Route};
