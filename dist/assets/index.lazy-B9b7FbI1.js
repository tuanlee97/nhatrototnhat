import{V as A,an as oe,Q as de,r as b,j as e,W as J,X as W,Y as he,B as F,Z as Y,_ as P,ao as U,af as q,f as R,ap as me,aq as ue,a1 as X,ar as ge,a2 as ee,e as xe,t as pe,z as j,a3 as je,a4 as fe,a5 as be,a6 as ye,a7 as ve,y as Ce,F as Ne,g as v,h as C,i as N,k as T,I as D,l as w,P as E,aa as we,o as M,n as k,as as Se,ad as ke,ae as Te,ag as Ie,ah as De,ai as Me,aj as z,ak as Fe,al as Ve,am as B,H as _e,E as Pe,T as Ue,J as Re,M as ze,c as He}from"./index-CJ1AcNxb.js";import{C as O,L as Q,d as qe}from"./debounce-CMqhm6O_.js";import{D as I}from"./data-table-column-header-FtAG0BCC.js";import{u as Ae,D as Xe,I as Le,M as Ke,C as Ee,a as Be,f as Z,b as Oe,g as Qe,c as Ze,d as $e,e as Ge,h as Je,i as We}from"./index-BcGaQFY_.js";import{I as Ye}from"./IconEdit-DyWwXMJq.js";import{S as H}from"./select-dropdown-poKp0Avh.js";import{C as se,A as ae,b as ne,a as es}from"./alert-bq5yZ8aI.js";import{I as ss}from"./IconAlertTriangle-VRRGoB_F.js";import{I as as}from"./IconUserPlus-DlXZMKer.js";import{D as $}from"./data-table-faceted-filter-y9yjApET.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var te=A("outline","user-check","IconUserCheck",[["path",{d:"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0",key:"svg-0"}],["path",{d:"M6 21v-2a4 4 0 0 1 4 -4h4",key:"svg-1"}],["path",{d:"M15 19l2 2l4 -4",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ns=A("outline","user-hexagon","IconUserHexagon",[["path",{d:"M12 13a3 3 0 1 0 0 -6a3 3 0 0 0 0 6z",key:"svg-0"}],["path",{d:"M6.201 18.744a4 4 0 0 1 3.799 -2.744h4a4 4 0 0 1 3.798 2.741",key:"svg-1"}],["path",{d:"M19.875 6.27c.7 .398 1.13 1.143 1.125 1.948v7.284c0 .809 -.443 1.555 -1.158 1.948l-6.75 4.27a2.269 2.269 0 0 1 -2.184 0l-6.75 -4.27a2.225 2.225 0 0 1 -1.158 -1.948v-7.285c0 -.809 .443 -1.554 1.158 -1.947l6.75 -3.98a2.33 2.33 0 0 1 2.25 0l6.75 3.98h-.033z",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ts=A("outline","user-shield","IconUserShield",[["path",{d:"M6 21v-2a4 4 0 0 1 4 -4h2",key:"svg-0"}],["path",{d:"M22 16c0 4 -2.5 6 -3.5 6s-3.5 -2 -3.5 -6c1 0 2.5 -.5 3.5 -1.5c1 1 2.5 1.5 3.5 1.5z",key:"svg-1"}],["path",{d:"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0",key:"svg-2"}]]);const ls=new Map([["active","bg-teal-100/30 text-teal-900 dark:text-teal-200 border-teal-200"],["inactive","bg-neutral-300/40 border-neutral-300"],["invited","bg-sky-200/40 text-sky-900 dark:text-sky-100 border-sky-300"],["suspended","bg-destructive/10 dark:bg-destructive/50 text-destructive dark:text-primary border-destructive/10"]]),le=[{label:"Hoạt động",value:"active"},{label:"Chưa duyệt",value:"inactive"},{label:"Đã mời",value:"invited"},{label:"Đình chỉ",value:"suspended"}],L=[{label:"Quản trị viên",value:"admin",icon:ns},{label:"Quản lý",value:"owner",icon:ts},{label:"Nhân viên",value:"employee",icon:oe},{label:"Khách hàng",value:"customer",icon:de}],re=J.createContext(null);function rs({children:s}){const[a,n]=Ae(null),[l,r]=b.useState(null),[i,o]=b.useState(null);return e.jsx(re,{value:{open:a,setOpen:n,currentRow:l,setCurrentRow:r,currentRowIndex:i,setCurrentRowIndex:o},children:s})}const K=()=>{const s=J.useContext(re);if(!s)throw new Error("useUsers has to be used within <UsersContext>");return s};function is({row:s}){const{setOpen:a,setCurrentRow:n,setCurrentRowIndex:l}=K(),r=s.getValue("role"),i=s.getValue("status");return e.jsx(e.Fragment,{children:e.jsxs(W,{modal:!1,children:[e.jsx(he,{asChild:!0,children:e.jsxs(F,{variant:"ghost",className:"flex h-8 w-8 p-0 data-[state=open]:bg-muted",children:[e.jsx(Xe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsxs(Y,{align:"end",className:"w-[160px]",children:[e.jsxs(P,{onClick:()=>{n(s.original),l(s.index),a("edit")},children:["Chỉnh sửa",e.jsx(U,{children:e.jsx(Ye,{size:16})})]}),i==="inactive"&&e.jsxs(e.Fragment,{children:[e.jsx(q,{}),e.jsxs(P,{onClick:()=>{n(s.original),l(s.index),a("active")},className:"text-yellow-600",children:["Phê duyệt",e.jsx(U,{children:e.jsx(te,{size:16})})]})]}),r!=="admin"&&e.jsxs(e.Fragment,{children:[e.jsx(q,{}),e.jsxs(P,{onClick:()=>{n(s.original),l(s.index),a("delete")},className:"!text-red-500",children:["Xóa",e.jsx(U,{children:e.jsx(Le,{size:16})})]})]})]})]})})}const cs=[{id:"select",header:({table:s})=>e.jsx(O,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:a=>s.toggleAllPageRowsSelected(!!a),"aria-label":"Select all",className:"translate-y-[2px]"}),meta:{className:R("sticky md:table-cell left-0 z-10 rounded-tl","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted")},cell:({row:s})=>e.jsx(O,{checked:s.getIsSelected(),onCheckedChange:a=>s.toggleSelected(!!a),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"username",header:({column:s})=>e.jsx(I,{column:s,title:"Tên người dùng"}),cell:({row:s})=>e.jsx(Q,{className:"max-w-36",children:s.getValue("username")}),meta:{className:R("drop-shadow-[0_1px_2px_rgb(0_0_0_/_0.1)] dark:drop-shadow-[0_1px_2px_rgb(255_255_255_/_0.1)] lg:drop-shadow-none","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted","sticky left-6 md:table-cell")},enableHiding:!1},{accessorKey:"name",header:({column:s})=>e.jsx(I,{column:s,title:"Tên"}),cell:({row:s})=>e.jsx(Q,{className:"max-w-36",children:s.getValue("name")}),meta:{className:"w-36"}},{accessorKey:"email",header:({column:s})=>e.jsx(I,{column:s,title:"Email"}),cell:({row:s})=>e.jsx("div",{className:"w-fit text-nowrap",children:s.getValue("email")})},{accessorKey:"phone",header:({column:s})=>e.jsx(I,{column:s,title:"Số điện thoại"}),cell:({row:s})=>e.jsx("div",{children:me(s.getValue("phone"))}),enableSorting:!1},{accessorKey:"status",header:({column:s})=>e.jsx(I,{column:s,title:"Trạng thái"}),cell:({row:s})=>{const{status:a}=s.original;if(!a)return null;const n={active:"Hoạt động",inactive:"Chưa duyệt",invited:"Đã mời",suspended:"Đình chỉ"},l=ls.get(a);return e.jsx("div",{className:"flex space-x-2",children:e.jsx(ue,{variant:"outline",className:R("capitalize",l),children:n[a]||a})})},filterFn:(s,a,n)=>n.includes(s.getValue(a)),enableHiding:!1,enableSorting:!1},{accessorKey:"role",header:({column:s})=>e.jsx(I,{column:s,title:"Vai trò"}),cell:({row:s})=>{const{role:a}=s.original,n=L.find(({value:l})=>l===a);return n?e.jsxs("div",{className:"flex items-center gap-x-2",children:[n.icon&&e.jsx(n.icon,{size:16,className:"text-muted-foreground"}),e.jsx("span",{className:"text-sm capitalize",children:n.label})]}):null},filterFn:(s,a,n)=>n.includes(s.getValue(a)),enableSorting:!1,enableHiding:!1},{id:"actions",cell:is}],os=j.object({name:j.string().min(1,{message:"Tên là bắt buộc."}),username:j.string().min(1,{message:"Tên truy cập là bắt buộc."}),phoneNumber:j.string().min(1,{message:"Số điện thoại là bắt buộc."}),email:j.string().min(1,{message:"Email là bắt buộc."}).email({message:"Email không hợp lệ."}),password:j.string().transform(s=>s.trim()),role:j.string().min(1,{message:"Vai trò là bắt buộc."}),branch_id:j.string().optional(),confirmPassword:j.string().transform(s=>s.trim()),isEdit:j.boolean(),userStatus:j.enum(["active","inactive","invited","suspended"],{message:"Trạng thái là bắt buộc."})}).superRefine(({isEdit:s,password:a,confirmPassword:n,role:l,branch_id:r},i)=>{s||(a===""&&i.addIssue({code:j.ZodIssueCode.custom,message:"Mật khẩu là bắt buộc.",path:["password"]}),a.length<6&&i.addIssue({code:j.ZodIssueCode.custom,message:"Mật khẩu phải dài ít nhất 6 ký tự.",path:["password"]}),a.match(/[a-z]/)||i.addIssue({code:j.ZodIssueCode.custom,message:"Mật khẩu phải chứa ít nhất một chữ cái thường.",path:["password"]}),a.match(/\d/)||i.addIssue({code:j.ZodIssueCode.custom,message:"Mật khẩu phải chứa ít nhất một số.",path:["password"]}),a!==n&&i.addIssue({code:j.ZodIssueCode.custom,message:"Mật khẩu không khớp.",path:["confirmPassword"]})),["employee","customer"].includes(l)&&!r&&i.addIssue({code:j.ZodIssueCode.custom,message:"Chi nhánh là bắt buộc cho vai trò nhân viên hoặc khách hàng.",path:["branch_id"]})});function G({currentRow:s,open:a,onOpenChange:n,page:l,limit:r,role:i,search:o}){var S;const c=!!s,m=X(),{user:f}=ge.getState().auth,g=f==null?void 0:f.role,{data:x}=ee({queryKey:["branches",l,r,o],queryFn:()=>M.getAllBranches({page:l,limit:r,search:o}),staleTime:5*60*1e3,retry:2,enabled:a&&["admin","owner","employee"].includes(g||"")}),h=(x==null?void 0:x.data.map(t=>({label:t.name,value:t.id.toString()})))||[],d=xe({resolver:pe(os),defaultValues:c?{name:s.name,username:s.username,email:s.email,role:s.role,phoneNumber:s.phone??"",branch_id:((S=s.branch_id)==null?void 0:S.toString())??"",password:"",confirmPassword:"",isEdit:c,userStatus:s.status??"inactive"}:{name:"",username:"",email:"",role:"",phoneNumber:"",branch_id:"",password:"",confirmPassword:"",isEdit:c,userStatus:"inactive"}});async function V(t){var p,u;try{let y=null;c?y=await M.updateUser({id:s.id,email:t.email,name:t.name.trim(),role:t.role,status:t.userStatus,phone:t.phoneNumber,branch_id:t.branch_id,...t.password&&{password:t.password}}):y=await M.createUser({username:t.username,password:t.password,email:t.email,name:t.name.trim(),role:t.role,status:t.userStatus,phone:t.phoneNumber,branch_id:t.branch_id});const{data:ie,message:ce}=y;ie?(m.invalidateQueries({queryKey:["users",l,r,i,o]}),k({title:c?"Cập nhật thành công!":"Đăng ký thành công!"})):k({title:"Có lỗi xảy ra",description:ce||"Không thể hoàn tất hành động",variant:"destructive"})}catch(y){k({title:c?"Cập nhật thất bại":"Đăng ký thất bại",description:((u=(p=y.response)==null?void 0:p.data)==null?void 0:u.message)||"Lỗi hệ thống, vui lòng thử lại sau",variant:"destructive"})}finally{d.reset(),n(!1)}}const _=!!d.formState.dirtyFields.password;return e.jsx(je,{open:a,onOpenChange:t=>{d.reset(),n(t)},children:e.jsxs(fe,{className:"sm:max-w-lg",children:[e.jsxs(be,{className:"text-left",children:[e.jsx(ye,{children:c?"Chỉnh sửa người dùng":"Thêm người dùng mới"}),e.jsxs(ve,{children:[c?"Chỉnh sửa người dùng tại đây.":"Tạo người dùng mới tại đây."," ","Nhấp vào lưu khi bạn hoàn tất."]})]}),e.jsx(Ce,{className:"-mr-4 h-[29.25rem] w-full py-1 pr-4",children:e.jsx(Ne,{...d,children:e.jsxs("form",{id:"user-form",onSubmit:d.handleSubmit(V),className:"space-y-4 p-0.5",children:[e.jsx(v,{control:d.control,name:"name",render:({field:t})=>e.jsxs(C,{className:"grid grid-cols-6 items-center gap-x-4 gap-y-1 space-y-0",children:[e.jsx(N,{className:"col-span-2 text-right",children:"Tên"}),e.jsx(T,{children:e.jsx(D,{placeholder:"Văn A",className:"col-span-4",autoComplete:"off",...t})}),e.jsx(w,{className:"col-span-4 col-start-3"})]})}),e.jsx(v,{control:d.control,name:"username",disabled:c,render:({field:t})=>e.jsxs(C,{className:"grid grid-cols-6 items-center gap-x-4 gap-y-1 space-y-0",children:[e.jsx(N,{className:"col-span-2 text-right",children:"Tên truy cập"}),e.jsx(T,{children:e.jsx(D,{placeholder:"nguyen_a",className:"col-span-4",...t})}),e.jsx(w,{className:"col-span-4 col-start-3"})]})}),e.jsx(v,{control:d.control,name:"email",render:({field:t})=>e.jsxs(C,{className:"grid grid-cols-6 items-center gap-x-4 gap-y-1 space-y-0",children:[e.jsx(N,{className:"col-span-2 text-right",children:"Email"}),e.jsx(T,{children:e.jsx(D,{placeholder:"nguyen.a@gmail.com",className:"col-span-4",...t})}),e.jsx(w,{className:"col-span-4 col-start-3"})]})}),e.jsx(v,{control:d.control,name:"phoneNumber",render:({field:t})=>e.jsxs(C,{className:"grid grid-cols-6 items-center gap-x-4 gap-y-1 space-y-0",children:[e.jsx(N,{className:"col-span-2 text-right",children:"Số điện thoại"}),e.jsx(T,{children:e.jsx(D,{placeholder:"+123456789",className:"col-span-4",...t})}),e.jsx(w,{className:"col-span-4 col-start-3"})]})}),e.jsx(v,{control:d.control,name:"role",render:({field:t})=>e.jsxs(C,{className:"grid grid-cols-6 items-center gap-x-4 gap-y-1 space-y-0",children:[e.jsx(N,{className:"col-span-2 text-right",children:"Vai trò"}),e.jsx(H,{defaultValue:t.value,onValueChange:t.onChange,placeholder:"Chọn vai trò",className:"col-span-4",items:L.filter(({value:p})=>g==="admin"?!0:g==="owner"?p!=="admin"&&p!=="owner":g==="employee"?p==="customer":!1).map(({label:p,value:u})=>({label:p,value:u}))}),e.jsx(w,{className:"col-span-4 col-start-3"})]})}),["employee","customer"].includes(d.watch("role"))&&e.jsx(v,{control:d.control,name:"branch_id",render:({field:t})=>e.jsxs(C,{className:"grid grid-cols-6 items-center gap-x-4 gap-y-1 space-y-0",children:[e.jsx(N,{className:"col-span-2 text-right",children:"Chi nhánh"}),e.jsx(H,{defaultValue:t.value,onValueChange:t.onChange,placeholder:"Chọn chi nhánh",className:"col-span-4",items:h}),e.jsx(w,{className:"col-span-4 col-start-3"})]})}),e.jsx(v,{control:d.control,name:"userStatus",render:({field:t})=>e.jsxs(C,{className:"grid grid-cols-6 items-center gap-x-4 gap-y-1 space-y-0",children:[e.jsx(N,{className:"col-span-2 text-right",children:"Trạng thái"}),e.jsx(H,{defaultValue:t.value,onValueChange:t.onChange,placeholder:"Chọn trạng thái",className:"col-span-4",items:le.map(({label:p,value:u})=>({label:p,value:u}))}),e.jsx(w,{className:"col-span-4 col-start-3"})]})}),!c&&e.jsxs(e.Fragment,{children:[e.jsx(v,{control:d.control,name:"password",render:({field:t})=>e.jsxs(C,{className:"grid grid-cols-6 items-center gap-x-4 gap-y-1 space-y-0",children:[e.jsx(N,{className:"col-span-2 text-right",children:"Mật khẩu"}),e.jsx(T,{children:e.jsx(E,{placeholder:"e.g., S3cur3P@ssw0rd",className:"col-span-4",...t})}),e.jsx(w,{className:"col-span-4 col-start-3"})]})}),e.jsx(v,{control:d.control,name:"confirmPassword",render:({field:t})=>e.jsxs(C,{className:"grid grid-cols-6 items-center gap-x-4 gap-y-1 space-y-0",children:[e.jsx(N,{className:"col-span-2 text-right",children:"Nhập lại mật khẩu"}),e.jsx(T,{children:e.jsx(E,{disabled:!_,placeholder:"e.g., S3cur3P@ssw0rd",className:"col-span-4",...t})}),e.jsx(w,{className:"col-span-4 col-start-3"})]})})]})]})})}),e.jsx(we,{children:e.jsx(F,{type:"submit",form:"user-form",children:"Xác nhận"})})]})})}function ds({open:s,onOpenChange:a,currentRow:n,page:l,limit:r,role:i,search:o}){const c=X();async function m(){var f,g;try{await M.updateUser({...n,role:n.role,id:n.id,phone:n.phone||"",status:"active"}),c.invalidateQueries({queryKey:["users",l,r,i,o]}),k({title:"Phê duyệt thành công"})}catch(x){k({title:"Phê duyệt thất bại",description:((g=(f=x.response)==null?void 0:f.data)==null?void 0:g.message)||"Lỗi hệ thống, vui lòng thử lại sau",variant:"destructive"})}finally{a(!1)}}return e.jsx(se,{open:s,onOpenChange:a,handleConfirm:m,title:e.jsxs("span",{className:"text-primary",children:[e.jsx(te,{className:"mr-1 inline-block stroke-primary",size:18})," ","Phê duyệt người dùng"]}),desc:e.jsx(ae,{variant:"default",children:e.jsxs(ne,{children:["Bạn chắc chắn muốn phê duyệt"," `",e.jsx("span",{className:"font-bold",children:n.username}),"?"]})}),confirmText:"Duyệt"})}function hs({open:s,onOpenChange:a,currentRow:n,page:l,limit:r,role:i,search:o}){const[c,m]=b.useState(""),f=X();async function g(){var x,h;if(c.trim()===n.username)try{await M.deleteUser(n.id),f.invalidateQueries({queryKey:["users",l,r,i,o]}),k({title:"Xóa người dùng thành công!"})}catch(d){k({title:"Xóa người dùng thất bại",description:((h=(x=d.response)==null?void 0:x.data)==null?void 0:h.message)||"Lỗi hệ thống, vui lòng thử lại sau",variant:"destructive"})}finally{m(""),a(!1)}}return e.jsx(se,{open:s,onOpenChange:a,handleConfirm:g,disabled:c.trim()!==n.username,title:e.jsxs("span",{className:"text-destructive",children:[e.jsx(ss,{className:"mr-1 inline-block stroke-destructive",size:18})," ","Xóa người dùng"]}),desc:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"mb-2",children:["Bạn chắc chắn muốn xóa người dùng"," ",e.jsx("span",{className:"font-bold",children:n.username}),"?",e.jsx("br",{}),"Hành động này sẽ xóa hết các thông tin của người dùng bao gồm :"," "]}),e.jsxs("ul",{className:"list-disc pl-5 py-2",children:[e.jsx("li",{children:"Xóa tất cả chi nhánh nếu người dùng là chủ sở hữu."}),e.jsx("li",{children:"Xóa tất cả phòng liên quan đến các chi nhánh bị xóa."}),e.jsx("li",{children:"Xóa tất cả hợp đồng của người dùng."}),e.jsx("li",{children:"Xóa tất cả thanh toán liên quan đến hợp đồng."}),e.jsx("li",{children:"Xóa các dịch vụ phòng, yêu cầu bảo trì, và thông tin người ở liên quan."}),e.jsx("li",{children:"Xóa logs, tickets, notifications, và các phân công nhân viên của người dùng."})]}),e.jsxs(Se,{className:"py-2",children:[e.jsx("span",{className:"font-bold",children:"Xác nhận:"}),e.jsx(D,{value:c,onChange:x=>m(x.target.value),placeholder:`Gõ vào \`${n.username}\` để xác nhận xóa`})]}),e.jsxs(ae,{variant:"destructive",children:[e.jsx(es,{children:"Cảnh báo!"}),e.jsx(ne,{children:"Cẩn trọng, hành động này không thể hoàn tác."})]})]}),confirmText:"Xóa",destructive:!0})}function ms({page:s,limit:a,role:n,search:l}){const{open:r,setOpen:i,currentRow:o,setCurrentRow:c}=K();return r?e.jsxs(e.Fragment,{children:[r==="add"&&e.jsx(G,{page:s,limit:a,role:n,search:l,open:!0,onOpenChange:()=>i("add")},"user-add"),o&&e.jsxs(e.Fragment,{children:[r==="edit"&&e.jsx(G,{page:s,limit:a,role:n,search:l,open:!0,onOpenChange:()=>{i("edit"),setTimeout(()=>{c(null)},500)},currentRow:o},`user-edit-${o.id}`),r==="active"&&e.jsx(ds,{open:!0,onOpenChange:()=>{i("active"),setTimeout(()=>{c(null)},500)},currentRow:o,page:s,limit:a,role:n,search:l},`user-active-${o.id}`),r==="delete"&&e.jsx(hs,{open:!0,onOpenChange:()=>{i("delete"),setTimeout(()=>{c(null)},500)},page:s,limit:a,role:n,search:l,currentRow:o},`user-delete-${o.id}`)]})]}):null}function us(){const{setOpen:s}=K();return e.jsx("div",{className:"flex gap-2",children:e.jsxs(F,{className:"space-x-1",onClick:()=>s("add"),children:[e.jsx("span",{children:"Thêm người dùng"})," ",e.jsx(as,{size:18})]})})}const gs={name:"Tên",email:"Email",phone:"Số điện thoại",username:"Tên người dùng"};function xs({table:s}){return e.jsxs(W,{modal:!1,children:[e.jsx(ke,{asChild:!0,children:e.jsxs(F,{variant:"outline",size:"sm",className:"ml-auto hidden h-8 lg:flex",children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),"Xem"]})}),e.jsxs(Y,{align:"end",className:"w-[150px]",children:[e.jsx(Te,{children:"Hiển thị cột"}),e.jsx(q,{}),s.getAllColumns().filter(a=>typeof a.accessorFn<"u"&&a.getCanHide()).map(a=>e.jsx(Ie,{className:"capitalize",checked:a.getIsVisible(),onCheckedChange:n=>a.toggleVisibility(!!n),children:gs[a.id]},a.id))]})]})}function ps({table:s,setSearch:a,setRole:n,role:l}){var f,g,x;const r=s.getState().columnFilters.length>0||!!((f=s.getColumn("username"))!=null&&f.getFilterValue())||!!((g=s.getColumn("role"))!=null&&g.getFilterValue()),i=b.useMemo(()=>qe(h=>a(h),500),[a]),o=h=>{var d;(d=s.getColumn("username"))==null||d.setFilterValue(h),i(h)},c=l?l.split(",").filter(Boolean):[],m=h=>{const d=h.join(",");d!==l&&n(d)};return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx(D,{placeholder:"Tìm kiếm người dùng...",value:((x=s.getColumn("username"))==null?void 0:x.getFilterValue())??"",onChange:h=>o(h.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),e.jsxs("div",{className:"flex gap-x-2",children:[s.getColumn("role")&&e.jsx($,{column:s.getColumn("role"),title:"Vai trò",options:L.map(h=>({label:h.label,value:h.value})),selected:c,onChange:m}),s.getColumn("status")&&e.jsx($,{column:s.getColumn("status"),title:"Trạng thái",options:le.map(h=>({label:h.label,value:h.value}))})]}),r&&e.jsxs(F,{variant:"ghost",onClick:()=>{a(""),n(""),s.resetColumnFilters()},className:"h-8 px-2 lg:px-3",children:["Xóa bộ lọc",e.jsx(Ee,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(xs,{table:s})]})}function js({columns:s,data:a,pagination:n,setPage:l,setLimit:r,setSearch:i,setRole:o,role:c}){var t;const[m,f]=b.useState({}),[g,x]=b.useState({}),[h,d]=b.useState([]),[V,_]=b.useState([]),S=Be({data:a,columns:s,state:{sorting:V,columnVisibility:g,rowSelection:m,columnFilters:h,pagination:{pageIndex:n.current_page-1,pageSize:n.limit}},manualPagination:!0,pageCount:n.total_pages,enableRowSelection:!0,onRowSelectionChange:f,onSortingChange:_,onColumnFiltersChange:d,onColumnVisibilityChange:x,getCoreRowModel:We(),getFilteredRowModel:Je(),getPaginationRowModel:Ge(),getSortedRowModel:$e(),getFacetedRowModel:Ze(),getFacetedUniqueValues:Qe()});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(ps,{table:S,setSearch:i,setRole:o,role:c}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(De,{children:[e.jsx(Me,{children:S.getHeaderGroups().map(p=>e.jsx(z,{className:"group/row",children:p.headers.map(u=>{var y;return e.jsx(Fe,{colSpan:u.colSpan,className:((y=u.column.columnDef.meta)==null?void 0:y.className)??"",children:u.isPlaceholder?null:Z(u.column.columnDef.header,u.getContext())},u.id)})},p.id))}),e.jsx(Ve,{children:(t=S.getRowModel().rows)!=null&&t.length?S.getRowModel().rows.map(p=>e.jsx(z,{"data-state":p.getIsSelected()&&"selected",className:"group/row",children:p.getVisibleCells().map(u=>{var y;return e.jsx(B,{className:((y=u.column.columnDef.meta)==null?void 0:y.className)??"",children:Z(u.column.columnDef.cell,u.getContext())},u.id)})},p.id)):e.jsx(z,{children:e.jsx(B,{colSpan:s.length,className:"h-24 text-center",children:"Không có kết quả."})})})]})}),e.jsx(Oe,{table:S,setPage:l,setLimit:r,totalRecords:n.total_records})]})}function fs(){const[s,a]=b.useState(1),[n,l]=b.useState(10),[r,i]=b.useState(""),[o,c]=b.useState(""),{data:m,isLoading:f,error:g}=ee({queryKey:["users",s,n,r,o],queryFn:()=>M.getAllUsers({page:s,limit:n,role:r,search:o}),staleTime:5*60*1e3,retry:2});g&&k({variant:"destructive",title:"Lỗi khi tải danh sách người dùng",description:g.message,duration:5e3});const x=(m==null?void 0:m.data)||[],h=(m==null?void 0:m.pagination)||{current_page:1,limit:10,total_records:0,total_pages:1};return e.jsxs(rs,{children:[e.jsxs(_e,{fixed:!0,children:[e.jsx(Pe,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Ue,{}),e.jsx(Re,{})]})]}),e.jsx(ze,{children:f&&!m?e.jsx("div",{className:"flex h-full items-center justify-center",children:"Đang tải người dùng..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center justify-between space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Danh sách người dùng"}),e.jsx("p",{className:"text-muted-foreground",children:"Quản lý người dùng và vai trò của họ ở đây."})]}),e.jsx(us,{})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(js,{data:x,columns:cs,pagination:h,setPage:a,setLimit:l,setRole:i,setSearch:c,role:r})})]})}),e.jsx(ms,{page:s,limit:n,role:r,search:o})]})}const Ds=He("/_authenticated/users/")({component:fs});export{Ds as Route};
